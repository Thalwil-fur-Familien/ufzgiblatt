var Fe=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports);var At=Fe((Bt,oe)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();(function(a,e){var n,s,t,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,o,l){function d(u,p){var m=p.split(".");m.length==2&&(u=u[m[0]],p=m[1]),u[p]=function(){u.push([p].concat(Array.prototype.slice.call(arguments,0)))}}(t=a.createElement("script")).type="text/javascript",t.async=!0,t.src=o.api_host+"/static/array.js",(r=a.getElementsByTagName("script")[0]).parentNode.insertBefore(t,r);var c=e;for(l!==void 0?c=e[l]=[]:l="posthog",c.people=c.people||[],c.toString=function(u){var p="posthog";return l!=="posthog"&&(p+="."+l),u||(p+=" (stub)"),p},c.people.toString=function(){return c.toString(1)+".people (stub)"},n="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys getNextSurveyStep onSessionId".split(" "),s=0;s<n.length;s++)d(c,n[s]);e._i.push([i,o,l])},e.__SV=1)})(document,window.posthog||[]);window.posthog&&window.posthog.init("phc_St9Kl05TiILCsblD5i9EUDNcsW6Yf8L6fGfpVQbat6H",{api_host:"https://eu.i.posthog.com",person_profiles:"identified_only"});function Le(a){return function(){var e=a+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}let Z=Math.floor(Math.random()*4294967295),X=Le(Z);function ne(a){Z=a,X=Le(Z)}function h(a,e){return Math.floor(X()*(e-a+1))+a}function Pe(a,e){for(a=Math.abs(a),e=Math.abs(e);e;){var n=e;e=a%e,a=n}return a}function V(){const a=new URLSearchParams(window.location.search),e=window.location.hash;if(e.includes("?")){const s=e.split("?")[1],t=new URLSearchParams(s);for(const[r,i]of t)a.set(r,i)}else if(e.includes("&")&&!e.startsWith("#generator")&&!e.startsWith("#builder")){const n=new URLSearchParams(e.substring(1));for(const[s,t]of n)a.set(s,t)}return a}function ie(){const a=window.location.hash.substring(1);return a&&a.split(/[?&]/)[0]||"generator"}const ve={de:{ui:{title:"ufzgiblatt.ch",gradeLabel:"Klasse",grades:{1:"1.",2:"2.",3:"3.",4:"4.",5:"5.",6:"6."},labelCount:"Anzahl:",labelDensity:"Dichte:",labelSolutions:"L√∂sungen",btnGenerate:"üîÑ Neu w√ºrfeln",btnSave:"üíæ Speichern",btnSaved:"üìÇ Laden",btnPrint:"üñ®Ô∏è Drucken",btnPlay:"Spielen",btnBack:"‚Üê Zur√ºck",labelShowQR:"QR Code",customTitle:"W√§hle die Aufgabentypen:",modalTitle:"Gespeicherte Arbeitsbl√§tter",modalClose:"Schliessen",feedback:"Feedback & Fehler melden",buildInfo:"Build Info",navGenerator:"Arbeitsbl√§tter",navBuilder:"Baukasten",navGames:"Spiele",navGameGeo:"Geographie",navAbout:"√úber uns",titleGames:"Lernspiele",titleAbout:"√úber uns",gameTitle:"Geographie - Schweizer Kantone lernen",gameCantonTitle:"Geographie",gameCantonDesc:"Lerne die Schweizer Kantone auf der interaktiven Karte kennen.",aboutIntro:'"Thalwil f√ºr Familien" ist eine Initiative, die sich f√ºr eine familienfreundliche Gemeinde einsetzt. Mit ufzgiblatt.ch m√∂chten wir Eltern und Kinder unterst√ºtzen.',headerName:"Name:",headerDate:"Datum:",solutionsSuffix:" (L√∂sungen)",answerLabel:"Antwort:",totalLabel:"Total:",timeLabel:"Uhr",timeReadingQuestion:"Es ist {time} Uhr. Wie sp√§t ist es in {duration} Min?",doubleLabel:"Verdopple:",halfLabel:"Halbiere:",roundingLabel:"Runde <b>{val}</b> auf <b>{place}er</b>:",wordTypesLegend:{noun:"Nomen",verb:"Verben",adj:"Adjektive",artikel:"Artikel",eraser:"Radiergummi",instruction:"(Klicke auf die W√∂rter zum Markieren)"},multiplesOf10:"Nur Zehnerzahlen (z.B. 30 + 70)",currency:"W√§hrung:",hours:"Stunden",minutes:"Minuten",individuelleAufgaben:"üõ†Ô∏è Individuelle Aufgaben",noSavedWorksheets:"Noch keine Arbeitsbl√§tter gespeichert.",btnLoad:"Laden",btnDelete:"L√∂schen",confirmDelete:"M√∂chtest du dieses Arbeitsblatt wirklich l√∂schen?",saveNothing:"Nichts zum Speichern gefunden.",savePrompt:"Bezeichnung f√ºr dieses Arbeitsblatt:",saveSuccess:"Erfolgreich gespeichert!",geoGame:{instruction:"Wo ist {region}?",instructionStart:"Klicke auf: {region}",instructionDrag:"Ziehe die Namen auf das richtige Gebiet!",score:"Punkte: {score} / {total}",loading:"Lade Karte...",error:"Fehler beim Laden der Karte.",win:"Super! Du hast alles gefunden!",nextRound:"N√§chste Runde...",feedbackWrong:"‚ùå Das ist {region}",modeFind:"Finde ...",modeDrag:"Namen zuordnen"},geoNames:{Europe:"Europa",Asia:"Asien","North America":"Nordamerika","South America":"S√ºdamerika",Africa:"Afrika",Australia:"Australien",Antarctica:"Antarktis",Russia:"Russland",Ukraine:"Ukraine",France:"Frankreich",Spain:"Spanien",Sweden:"Schweden",Norway:"Norwegen",Germany:"Deutschland",Finland:"Finnland",Poland:"Polen",Italy:"Italien","United Kingdom":"Vereinigtes K√∂nigreich",Romania:"Rum√§nien",Belarus:"Weissrussland",Kazakhstan:"Kasachstan",Greece:"Griechenland",Bulgaria:"Bulgarien",Iceland:"Island",Hungary:"Ungarn",Portugal:"Portugal",Austria:"√ñsterreich","Czech Republic":"Tschechien",Serbia:"Serbien",Ireland:"Irland",Lithuania:"Litauen",Latvia:"Lettland",Croatia:"Kroatien","Bosnia and Herzegovina":"Bosnien und Herzegowina",Slovakia:"Slowakei",Estonia:"Estland",Denmark:"D√§nemark",Switzerland:"Schweiz",Netherlands:"Niederlande",Moldova:"Moldawien",Belgium:"Belgien",Albania:"Albanien",Macedonia:"Mazedonien",Turkey:"T√ºrkei",Slovenia:"Slowenien",Montenegro:"Montenegro",Kosovo:"Kosovo",Cyprus:"Zypern",Luxembourg:"Luxemburg","Faroe Islands":"F√§r√∂er",Andorra:"Andorra",Malta:"Malta",Liechtenstein:"Liechtenstein",Guernsey:"Guernsey","San Marino":"San Marino",Gibraltar:"Gibraltar",Monaco:"Monaco","Vatican City":"Vatikanstadt","Svalbard and Jan Mayen":"Spitzbergen und Jan Mayen",Jersey:"Jersey","Isle of Man":"Insel Man",Georgia:"Georgien",Azerbaijan:"Aserbaidschan",Armenia:"Armenien","Aland Islands":"√Öland","Appenzell Inner-Rhoden":"Appenzell Innerrhoden","Appenzell Ausser-Rhoden":"Appenzell Ausserrhoden",Fribourg:"Freiburg",Gen√®ve:"Genf",Lucerne:"Luzern",Neuch√¢tel:"Neuenburg","Sankt Gallen":"St. Gallen",Ticino:"Tessin",Vaud:"Waadt",Valais:"Wallis"},builder:{title:"Individueller Baukasten",addItem:"‚ûï Aufgabe hinzuf√ºgen",refresh:"üîÑ Neu w√ºrfeln",generate:"‚ú® Arbeitsblatt erstellen",clear:"üóëÔ∏è Leeren",grade:"Klasse:",topic:"Aufgabe:",count:"Anzahl:",duplicate:"Duplizieren",delete:"L√∂schen",moveUp:"Nach oben",moveDown:"Nach unten",maxReached:"Maximale Anzahl an Aufgaben erreicht (16).",capacity:"Platz auf Seite {page}",options:{marriedMultiplesOf10:"Nur Zehnerzahlen",currency:"W√§hrung"},copyLink:"Link kopieren",linkCopied:"Link in die Zwischenablage kopiert!"}},topics:{add_10:"üü¢ Addition bis 10",sub_10:"üî¥ Subtraktion bis 10",add_20_simple:"‚ûï Addition bis 24 (ohne Zehner√ºbergang)",sub_20_simple:"‚ûñ Subtraktion bis 24 (ohne Zehner√ºbergang)",bonds_10:"‚ù§Ô∏è Verliebte Zahlen (bis 10)",rechenmauer_10:"üß± Kleine Rechenmauern (bis 10)",money_10:"üí∞ Geld (M√ºnzen bis 10 Fr)",add_20:"‚ûï Addition bis 24 (mit Zehner√ºbergang)",sub_20:"‚ûñ Subtraktion bis 24 (mit Zehner√ºbergang)",add_100_simple:"‚ûï Addition bis 100 (ohne Zehner√ºbergang)",add_100_carry:"‚ûï Addition bis 100 (mit Zehner√ºbergang)",sub_100_simple:"‚ûñ Subtraktion bis 100 (ohne Zehner√ºbergang)",sub_100_carry:"‚ûñ Subtraktion bis 100 (mit Zehner√ºbergang)",mult_2_5_10:"‚úñÔ∏è Kleines 1x1 (2er, 5er, 10er)",mult_all:"‚úñÔ∏è Kleines 1x1 (Gemischt)",div_2_5_10:"‚ûó Geteilt (2er, 5er, 10er)",rechenmauer:"üß± Rechenmauern (3 Ebenen)",rechenmauer_4:"üß± Rechenmauern (4 Ebenen)",doubling_halving:"üåì Halbieren und Verdoppeln",zahlenhaus_20:"üè† Zahlenhaus (bis 24)",word_problems:"üìù Sachrechnen (Textaufgaben)",time_reading:"üïí Uhrzeit lesen",time_analog_set:"üï∞Ô∏è Uhrzeit einzeichnen (Analog)",visual_add_100:"üî¢ Hunderterfeld: Addition",rechendreiecke:"üî∫ Rechendreiecke (bis 24)",rechenstrich:"üìè Rechenstrich (Addition)",married_100:"üíç Verheiratete Zahlen (bis 100)",money_100:"üí∞ Geld (M√ºnzen & Noten bis 100 Fr)",word_types:"üî§ Deutsch: Wortarten erkennen",add_1000:"‚ûï Addition bis 1000",sub_1000:"‚ûñ Subtraktion bis 1000",mult_advanced:"‚úñÔ∏è Erweitertes 1x1 (bis 24)",div_100:"‚ûó Division (bis 100 ohne Rest)",div_remainder:"‚ûó Division (mit Rest - Basis)",rechenmauer_100:"üß± Grosse Rechenmauern (bis 100)",time_duration:"‚è≥ Zeitspannen",time_analog_set_complex:"üï∞Ô∏è Uhrzeit einzeichnen (Digital -> Analog)",rechendreiecke_100:"üî∫ Rechendreiecke (bis 100)",zahlenhaus_100:"üè† Zahlenhaus (bis 100)",add_written:"‚úçÔ∏è Schriftliche Addition (bis 1 Mio)",sub_written:"‚úçÔ∏è Schriftliche Subtraktion (bis 1 Mio)",mult_large:"‚úçÔ∏è Schriftliche Multiplikation",div_long:"‚úçÔ∏è Schriftliche Division",rounding:"üéØ Runden (10er, 100er, 1000er)",dec_add:"‚ûï Dezimalzahlen: Addition",dec_sub:"‚ûñ Dezimalzahlen: Subtraktion",mult_10_100:"‚úñÔ∏è Malnehmen mit 10/100/1000",units:"‚öñÔ∏è Einheiten umrechnen (m, kg, s)",frac_simplify:"üç∞ Br√ºche: K√ºrzen/Erweitern",frac_add:"üç∞ Br√ºche: Addition",percent_basic:"üìä Prozentrechnung (Basis)"},word_problems:[{q:"Lisa hat 5 √Ñpfel. Sie kauft 3 dazu. Wie viele hat sie?",a:8},{q:"Tom hat 10 Ballons. 2 fliegen weg. Wie viele bleiben?",a:8},{q:"Eine Katze hat 4 Beine. Wie viele Beine haben 2 Katzen?",a:8},{q:"Oma backt 12 Kekse. Sie verteilt sie an 3 Enkel. Wie viele kriegt jeder?",a:4},{q:"Im Bus sind 5 Leute. An der Haltestelle steigen 4 ein. Wie viele sind es?",a:9},{q:"Max hat 20 Franken. Ein Buch kostet 15. Wie viel bleibt √ºbrig?",a:5}],word_types:[[{text:"Der",type:"artikel"},{text:"Hund",type:"noun"},{text:"bellt",type:"verb"},{text:"laut",type:"adj"},{text:".",type:"other"}],[{text:"Die",type:"artikel"},{text:"kleine",type:"adj"},{text:"Katze",type:"noun"},{text:"schl√§ft",type:"verb"},{text:".",type:"other"}],[{text:"Das",type:"artikel"},{text:"schnelle",type:"adj"},{text:"Auto",type:"noun"},{text:"f√§hrt",type:"verb"},{text:".",type:"other"}],[{text:"Peter",type:"noun"},{text:"isst",type:"verb"},{text:"einen",type:"artikel"},{text:"roten",type:"adj"},{text:"Apfel",type:"noun"},{text:".",type:"other"}],[{text:"Die",type:"artikel"},{text:"Sonne",type:"noun"},{text:"scheint",type:"verb"},{text:"hell",type:"adj"},{text:".",type:"other"}],[{text:"Wir",type:"other"},{text:"spielen",type:"verb"},{text:"im",type:"other"},{text:"gr√ºnen",type:"adj"},{text:"Garten",type:"noun"},{text:".",type:"other"}],[{text:"Der",type:"artikel"},{text:"Vogel",type:"noun"},{text:"singt",type:"verb"},{text:"ein",type:"artikel"},{text:"sch√∂nes",type:"adj"},{text:"Lied",type:"noun"},{text:".",type:"other"}],[{text:"Meine",type:"artikel"},{text:"Mutter",type:"noun"},{text:"kocht",type:"verb"},{text:"leckere",type:"adj"},{text:"Suppe",type:"noun"},{text:".",type:"other"}],[{text:"Der",type:"artikel"},{text:"fleissige",type:"adj"},{text:"Sch√ºler",type:"noun"},{text:"macht",type:"verb"},{text:"seine",type:"artikel"},{text:"schwierigen",type:"adj"},{text:"Hausaufgaben",type:"noun"},{text:"sehr",type:"other"},{text:"sorgf√§ltig",type:"adj"},{text:".",type:"other"}],[{text:"Die",type:"artikel"},{text:"bunten",type:"adj"},{text:"Blumen",type:"noun"},{text:"bl√ºhen",type:"verb"},{text:"im",type:"other"},{text:"sch√∂nen",type:"adj"},{text:"Fr√ºhling",type:"noun"},{text:".",type:"other"}],[{text:"Ein",type:"artikel"},{text:"grosser",type:"adj"},{text:"Elefant",type:"noun"},{text:"trinkt",type:"verb"},{text:"viel",type:"other"},{text:"frisches",type:"adj"},{text:"Wasser",type:"noun"},{text:"am",type:"other"},{text:"k√ºhlen",type:"adj"},{text:"Fluss",type:"noun"},{text:".",type:"other"}],[{text:"Mein",type:"artikel"},{text:"kleiner",type:"adj"},{text:"Bruder",type:"noun"},{text:"spielt",type:"verb"},{text:"gerne",type:"other"},{text:"mit",type:"other"},{text:"seinen",type:"artikel"},{text:"neuen",type:"adj"},{text:"Spielsachen",type:"noun"},{text:".",type:"other"}],[{text:"Die",type:"artikel"},{text:"freundliche",type:"adj"},{text:"Lehrerin",type:"noun"},{text:"erkl√§rt",type:"verb"},{text:"den",type:"artikel"},{text:"interessanten",type:"adj"},{text:"Stoff",type:"noun"},{text:"sehr",type:"other"},{text:"gut",type:"adj"},{text:".",type:"other"}],[{text:"Der",type:"artikel"},{text:"starke",type:"adj"},{text:"L√∂we",type:"noun"},{text:"br√ºllt",type:"verb"},{text:"laut",type:"adj"},{text:"in",type:"other"},{text:"der",type:"artikel"},{text:"weiten",type:"adj"},{text:"Steppe",type:"noun"},{text:".",type:"other"}],[{text:"Ein",type:"artikel"},{text:"kleines",type:"adj"},{text:"M√§dchen",type:"noun"},{text:"liest",type:"verb"},{text:"ein",type:"artikel"},{text:"spannendes",type:"adj"},{text:"Buch",type:"noun"},{text:"unter",type:"other"},{text:"dem",type:"artikel"},{text:"alten",type:"adj"},{text:"Baum",type:"noun"},{text:".",type:"other"}],[{text:"Wir",type:"other"},{text:"essen",type:"verb"},{text:"heute",type:"other"},{text:"einen",type:"artikel"},{text:"saftigen",type:"adj"},{text:"Kuchen",type:"noun"},{text:"und",type:"other"},{text:"trinken",type:"verb"},{text:"dazu",type:"other"},{text:"kalte",type:"adj"},{text:"Milch",type:"noun"},{text:"mit",type:"other"},{text:"Sahne",type:"noun"},{text:".",type:"other"}]]},en:{ui:{title:"ufzgiblatt.ch",gradeLabel:"Grade",grades:{1:"1st",2:"2nd",3:"3rd",4:"4th",5:"5th",6:"6th"},labelCount:"Count:",labelDensity:"Density:",labelSolutions:"Solutions",btnGenerate:"üîÑ Reseed",btnSave:"üíæ Save",btnSaved:"üìÇ Load",btnPrint:"üñ®Ô∏è Print",btnPlay:"Play Now",btnBack:"‚Üê Back",labelShowQR:"QR Code",customTitle:"Select task types:",modalTitle:"Saved Worksheets",modalClose:"Close",feedback:"Feedback & Report Bugs",buildInfo:"Build Info",navGenerator:"Worksheets",navBuilder:"Builder",navGames:"Games",navGameGeo:"Geography",navAbout:"About Us",titleGames:"Learning Games",titleAbout:"About Us",gameTitle:"Geography - Learn Swiss Cantons",gameCantonTitle:"Geography",gameCantonDesc:"Get to know the Swiss cantons on the interactive map.",aboutIntro:'"Thalwil for Families" is an initiative dedicated to a family-friendly community. With ufzgiblatt.ch, we aim to support parents and children.',headerName:"Name:",headerDate:"Date:",solutionsSuffix:" (Answers)",answerLabel:"Answer:",totalLabel:"Total:",timeLabel:"o'clock",timeReadingQuestion:"It is {time} o'clock. What time is it in {duration} min?",doubleLabel:"Double:",halfLabel:"Halve:",roundingLabel:"Round <b>{val}</b> to the nearest <b>{place}</b>:",wordTypesLegend:{noun:"Nouns",verb:"Verbs",adj:"Adjectives",artikel:"Articles",eraser:"Eraser",instruction:"(Click on the words to highlight)"},multiplesOf10:"Only multiples of 10 (e.g. 30 + 70)",currency:"Currency:",hours:"Hours",minutes:"Minutes",individuelleAufgaben:"üõ†Ô∏è Individual Tasks",noSavedWorksheets:"No worksheets saved yet.",btnLoad:"Open",btnDelete:"Delete",confirmDelete:"Are you sure you want to delete this worksheet?",saveNothing:"Nothing found to save.",savePrompt:"Label for this worksheet:",saveSuccess:"Saved successfully!",geoGame:{instruction:"Where is {region}?",instructionStart:"Click on: {region}",instructionDrag:"Drag the names to the correct region!",score:"Score: {score} / {total}",loading:"Loading map...",error:"Error loading map.",win:"Great job! You found everything!",nextRound:"Next round...",feedbackWrong:"‚ùå That is {region}",modeFind:"Find ...",modeDrag:"Allocate Name"},geoNames:{"Appenzell Inner-Rhoden":"Appenzell Innerrhoden","Appenzell Ausser-Rhoden":"Appenzell Ausserrhoden",Graub√ºnden:"Grisons",Gen√®ve:"Geneva",Lucerne:"Lucerne","Sankt Gallen":"St. Gallen",Z√ºrich:"Zurich"},builder:{title:"Worksheet Builder",addItem:"‚ûï Add Task",refresh:"üîÑ Reseed",generate:"‚ú® Create Worksheet!",clear:"üóëÔ∏è Clear All",grade:"Grade:",topic:"Task:",count:"Quantity:",duplicate:"Duplicate",delete:"Delete",moveUp:"Move Up",moveDown:"Move Down",maxReached:"Maximum number of tasks reached (16).",capacity:"Space on page {page}",options:{marriedMultiplesOf10:"Only multiples of 10",currency:"Currency"},copyLink:"Copy Link",linkCopied:"Link copied to clipboard!"}},topics:{add_10:"üü¢ Addition up to 10",sub_10:"üî¥ Subtraction up to 10",add_20_simple:"‚ûï Addition up to 24 (no regrouping)",sub_20_simple:"‚ûñ Subtraction up to 24 (no regrouping)",bonds_10:"‚ù§Ô∏è Number Bonds (up to 10)",rechenmauer_10:"üß± Small Number Pyramids (up to 10)",money_10:"üí∞ Money (Coins up to 10)",add_20:"‚ûï Addition up to 24 (with regrouping)",sub_20:"‚ûñ Subtraction up to 24 (with regrouping)",add_100_simple:"‚ûï Addition up to 100 (no regrouping)",add_100_carry:"‚ûï Addition up to 100 (with regrouping)",sub_100_simple:"‚ûñ Subtraction up to 100 (no regrouping)",sub_100_carry:"‚ûñ Subtraction up to 100 (with regrouping)",mult_2_5_10:"‚úñÔ∏è Basic Tables (2, 5, 10)",mult_all:"‚úñÔ∏è Multiplication (Mixed)",div_2_5_10:"‚ûó Division (2, 5, 10)",rechenmauer:"üß± Number Pyramids (3 levels)",rechenmauer_4:"üß± Number Pyramids (4 levels)",doubling_halving:"üåì Doubling and Halving",zahlenhaus_20:"üè† Number House (up to 24)",word_problems:"üìù Word Problems",time_reading:"üïí Telling Time (Read)",time_analog_set:"üï∞Ô∏è Draw Time (Analog)",visual_add_100:"üî¢ 100-Square: Addition",rechendreiecke:"üî∫ Math Triangles (up to 24)",rechenstrich:"üìè Number Line (Addition)",married_100:"üíç Married Numbers (up to 100)",money_100:"üí∞ Money (Coins & Notes up to 100)",word_types:"üî§ English: Identify Word Types",add_1000:"‚ûï Addition up to 1000",sub_1000:"‚ûñ Subtraction up to 1000",mult_advanced:"‚úñÔ∏è Advanced Tables (up to 24)",div_100:"‚ûó Division (up to 100)",div_remainder:"‚ûó Division (with Remainder)",rechenmauer_100:"üß± Large Number Pyramids (up to 100)",time_duration:"‚è≥ Time Intervals",time_analog_set_complex:"üï∞Ô∏è Draw Time (Digital -> Analog)",rechendreiecke_100:"üî∫ Math Triangles (up to 100)",zahlenhaus_100:"üè† Number House (up to 100)",add_written:"‚úçÔ∏è Column Addition (up to 1M)",sub_written:"‚úçÔ∏è Column Subtraction (up to 1M)",mult_large:"‚úçÔ∏è Long Multiplication",div_long:"‚úçÔ∏è Long Division",rounding:"üéØ Rounding (10s, 100s, 1000s)",dec_add:"‚ûï Decimals: Addition",dec_sub:"‚ûñ Decimals: Subtraktion",mult_10_100:"‚úñÔ∏è Multiply by 10/100/1000",units:"‚öñÔ∏è Unit Conversion (m, kg, s)",frac_simplify:"üç∞ Fractions: Simplify",frac_add:"üç∞ Fractions: Addition",percent_basic:"üìä Percentages (Basic)"},word_problems:[{q:"Lisa has 5 apples. She buys 3 more. How many does she have?",a:8},{q:"Tom has 10 balloons. 2 fly away. How many are left?",a:8},{q:"A cat has 4 legs. How many legs do 2 cats have?",a:8},{q:"Grandma bakes 12 cookies. She gives them to 3 grandkids. How many does each get?",a:4},{q:"There are 5 people on the bus. 4 more get on. How many are there now?",a:9},{q:"Max has 20 dollars. A book costs 15. How much is left?",a:5}],word_types:[[{text:"The",type:"artikel"},{text:"dog",type:"noun"},{text:"barks",type:"verb"},{text:"loudly",type:"adj"},{text:".",type:"other"}],[{text:"The",type:"artikel"},{text:"little",type:"adj"},{text:"cat",type:"noun"},{text:"sleeps",type:"verb"},{text:".",type:"other"}],[{text:"The",type:"artikel"},{text:"fast",type:"adj"},{text:"car",type:"noun"},{text:"drives",type:"verb"},{text:".",type:"other"}],[{text:"Peter",type:"noun"},{text:"eats",type:"verb"},{text:"a",type:"artikel"},{text:"red",type:"adj"},{text:"apple",type:"noun"},{text:".",type:"other"}],[{text:"The",type:"artikel"},{text:"sun",type:"noun"},{text:"shines",type:"verb"},{text:"brightly",type:"adj"},{text:".",type:"other"}],[{text:"We",type:"other"},{text:"play",type:"verb"},{text:"in",type:"other"},{text:"the",type:"artikel"},{text:"green",type:"adj"},{text:"garden",type:"noun"},{text:".",type:"other"}],[{text:"The",type:"artikel"},{text:"bird",type:"noun"},{text:"sings",type:"verb"},{text:"a",type:"artikel"},{text:"beautiful",type:"adj"},{text:"song",type:"noun"},{text:".",type:"other"}],[{text:"My",type:"artikel"},{text:"mother",type:"noun"},{text:"cooks",type:"verb"},{text:"delicious",type:"adj"},{text:"soup",type:"noun"},{text:".",type:"other"}],[{text:"The",type:"artikel"},{text:"hardworking",type:"adj"},{text:"student",type:"noun"},{text:"does",type:"verb"},{text:"his",type:"artikel"},{text:"difficult",type:"adj"},{text:"homework",type:"noun"},{text:"very",type:"other"},{text:"carefully",type:"adj"},{text:".",type:"other"}],[{text:"The",type:"artikel"},{text:"colorful",type:"adj"},{text:"flowers",type:"noun"},{text:"bloom",type:"verb"},{text:"in",type:"other"},{text:"the",type:"artikel"},{text:"beautiful",type:"adj"},{text:"spring",type:"noun"},{text:".",type:"other"}],[{text:"A",type:"artikel"},{text:"large",type:"adj"},{text:"elephant",type:"noun"},{text:"drinks",type:"verb"},{text:"lots",type:"other"},{text:"of",type:"other"},{text:"fresh",type:"adj"},{text:"water",type:"noun"},{text:"at",type:"other"},{text:"the",type:"artikel"},{text:"cool",type:"adj"},{text:"river",type:"noun"},{text:".",type:"other"}],[{text:"My",type:"artikel"},{text:"little",type:"adj"},{text:"brother",type:"noun"},{text:"plays",type:"verb"},{text:"happily",type:"other"},{text:"with",type:"other"},{text:"his",type:"artikel"},{text:"new",type:"adj"},{text:"toys",type:"noun"},{text:".",type:"other"}],[{text:"The",type:"artikel"},{text:"friendly",type:"adj"},{text:"teacher",type:"noun"},{text:"explains",type:"verb"},{text:"the",type:"artikel"},{text:"interesting",type:"adj"},{text:"material",type:"noun"},{text:"very",type:"other"},{text:"well",type:"adj"},{text:".",type:"other"}],[{text:"The",type:"artikel"},{text:"strong",type:"adj"},{text:"lion",type:"noun"},{text:"roars",type:"verb"},{text:"loudly",type:"adj"},{text:"in",type:"other"},{text:"the",type:"artikel"},{text:"wide",type:"adj"},{text:"savannah",type:"noun"},{text:".",type:"other"}],[{text:"A",type:"artikel"},{text:"little",type:"adj"},{text:"girl",type:"noun"},{text:"reads",type:"verb"},{text:"an",type:"artikel"},{text:"exciting",type:"adj"},{text:"book",type:"noun"},{text:"under",type:"other"},{text:"the",type:"artikel"},{text:"old",type:"adj"},{text:"tree",type:"noun"},{text:".",type:"other"}],[{text:"We",type:"other"},{text:"eat",type:"verb"},{text:"a",type:"artikel"},{text:"juicy",type:"adj"},{text:"cake",type:"noun"},{text:"today",type:"other"},{text:"and",type:"other"},{text:"drink",type:"verb"},{text:"cold",type:"adj"},{text:"milk",type:"noun"},{text:"with",type:"other"},{text:"it",type:"other"},{text:".",type:"other"}]]}};function Ge(){const a=V();if(a.has("lang")){const n=a.get("lang");if(n==="en"||n==="de")return n}try{const n=localStorage.getItem("ufzgiblatt_lang");if(n==="en"||n==="de")return n}catch{}const e=navigator.language;return e&&e.startsWith("en")?"en":"de"}function Oe(a){if(!(a!=="en"&&a!=="de"))try{localStorage.setItem("ufzgiblatt_lang",a)}catch(e){console.warn("Could not save language preference:",e)}}const F={default:{weight:36,span:12},add_10:{weight:9,span:3},sub_10:{weight:9,span:3},add_20_simple:{weight:9,span:3},sub_20_simple:{weight:9,span:3},bonds_10:{weight:9,span:3},mult_2_5_10:{weight:9,span:3},add_20:{weight:9,span:3},sub_20:{weight:9,span:3},add_100_simple:{weight:9,span:3},add_100_carry:{weight:9,span:3},sub_100_simple:{weight:9,span:3},sub_100_carry:{weight:9,span:3},mult_all:{weight:9,span:3},div_2_5_10:{weight:9,span:3},doubling_halving:{weight:9,span:3},married_100:{weight:9,span:3},add_1000:{weight:36,span:6},sub_1000:{weight:36,span:6},mult_advanced:{weight:9,span:3},div_100:{weight:9,span:3},div_remainder:{weight:18,span:3},dec_add:{weight:18,span:6},dec_sub:{weight:18,span:6},mult_10_100:{weight:18,span:6},units:{weight:9,span:3},percent_basic:{weight:18,span:6},rounding:{weight:9,span:3},frac_add:{weight:36,span:6},frac_simplify:{weight:36,span:6},rechenmauer_10:{weight:54,span:6},rechenmauer_100:{weight:54,span:6},rechenmauer:{weight:54,span:6},rechenmauer_4:{weight:72,span:6},rechendreiecke:{weight:72,span:6},rechendreiecke_100:{weight:72,span:6},zahlenhaus_10:{weight:27,span:3},zahlenhaus_20:{weight:27,span:3},zahlenhaus_100:{weight:27,span:3},time_reading:{weight:36,span:3},time_analog_set:{weight:36,span:3},time_analog_set_complex:{weight:36,span:3},time_duration:{weight:18,span:6},word_problems:{weight:108,span:12},visual_add_100:{weight:72,span:6},add_written:{weight:72,span:12},sub_written:{weight:72,span:12},mult_large:{weight:108,span:12},div_long:{weight:108,span:12},rechenstrich:{weight:108,span:12},money_10:{weight:90,span:6},money_100:{weight:90,span:6},word_types:{weight:72,span:12}};class G{data;weight;span;type;constructor(e){this.data=e;const n=F[e.moduleType]||F.default;this.weight=e.weight||n.weight,this.span=e.span||n.span,this.type=e.moduleType}}class C{static registry={};static register(e,n){this.registry[e]=n}static create(e){const n=this.registry[e.moduleType]||this.registry.default;if(n)return new n(e);throw new Error(`No problem class registered for type: ${e.moduleType}`)}static generate(e,n,s){const t=this.registry[e]||this.registry.default;if(t&&t.generate){const r=t.generate(e,n,s);if(!r)return null;const i=F[e]||F.default;return{...r,moduleType:e,type:r.type||e,weight:i.weight,span:i.span}}return null}}const we=540;function We(a,e=[],n=["CHF"],s={},t="de",r=we){const i=[],o=()=>!n||n.length===0?"CHF":n[h(0,n.length-1)];let l=0;const d=a==="custom"?e:[a];if(d.length===0)return[];const c=ve[t].word_types||[],u=Array.from({length:c.length},(f,g)=>g);u.sort(()=>X()-.5);let p=0,m=0;for(;l<r&&m<50;){let f;a==="custom"?f=d[h(0,d.length-1)]:f=a;const b=(F[f]||F.default).weight;if(l+b<=r){const k=o(),w=f==="word_types"?u[p++%c.length]:-1,S={...s,currency:k,wordTypeIndex:w},y=C.generate(f,S,t);y?(i.push(y),l+=b,m=0):m++}else m++}return i}function Ae(a,e="CHF",n={},s=-1,t="de"){const r={...n,currency:e,wordTypeIndex:s};return C.generate(a,r,t)}let L="de",v,se=[],he="",O="1",M=new Set;const W={1:["add_10","sub_10","add_20_simple","sub_20_simple","bonds_10","rechenmauer_10","money_10"],2:["add_20","sub_20","add_100_simple","add_100_carry","sub_100_simple","sub_100_carry","mult_2_5_10","mult_all","div_2_5_10","rechenmauer","rechenmauer_4","doubling_halving","zahlenhaus_20","word_problems","time_reading","time_analog_set","visual_add_100","rechendreiecke","rechenstrich","married_100","money_100","word_types"],3:["add_1000","sub_1000","mult_advanced","div_100","div_remainder","rechenmauer_100","time_duration","time_analog_set_complex","rechendreiecke_100","zahlenhaus_100"],4:["add_written","sub_written","mult_large","div_long","rounding"],5:["dec_add","dec_sub","mult_10_100","units"],6:["frac_simplify","frac_add","percent_basic"]};function Ie(a){L=a,window.lang=L}function Be(a){v=a,window.T=v}function me(a){he=a}function qe(a){se=a}function ge(a){O=a}function Ue(a,e){const n=document.createElement("div");n.className="problem";const s=a.span||12;n.style.gridColumn=`span ${s}`;const t=Math.max(1,Math.round(a.weight/s));n.style.gridRow=`span ${t}`;const r=document.createElement("div");r.className="problem-boundary",n.appendChild(r);const i=r,l=(F[a.moduleType]||F[a.type]||F.default).span||12,d=s/l;return Math.abs(d-1)>.01&&(i.style.transform=`scale(${d})`,i.style.transformOrigin="top left",i.style.width=`${100/d}%`,i.style.height=`${100/d}%`),C.create(a).render(i,e,L),n}function fe(a,e,n,s,t=!1,r="./"){const i=document.createElement("div");i.className="sheet";const o=document.createElement("div");o.className="qr-code-container";const l=document.getElementById("showQR");l&&!l.checked&&o.classList.add("qr-hidden"),i.appendChild(o);const d=document.createElement("img");d.src=r+"images/logo/logo_ufzgiblatt1_text_below_centered.png",d.className="sheet-logo",i.appendChild(d);const c=document.createElement("div");c.className="sheet-header",c.innerHTML=`
        <div style="width:190px;"></div>
        <div style="display:flex; gap: 40px;">
            <div class="header-field">${v.ui.headerName} <span class="line"></span></div>
            <div class="header-field">${v.ui.headerDate} <span class="line"></span></div>
        </div>
        <div style="width:100px;"></div>
    `,i.appendChild(c);const u=document.createElement("h1");u.textContent=a+(n?v.ui.solutionsSuffix:""),n&&(u.style.color="#27ae60"),t&&!n&&(u.contentEditable="true",u.style.minWidth="200px",u.oninput=function(f){const g=f.currentTarget;window.updateBuilderTitle?window.updateBuilderTitle(g.textContent):window.updateGeneratorTitle&&window.updateGeneratorTitle(g.textContent)},u.onkeydown=function(f){f.key==="Enter"&&(f.preventDefault(),f.currentTarget.blur())}),i.appendChild(u);const p=document.createElement("div");if(p.className="problem-grid",e.forEach(f=>{p.appendChild(Ue(f,n))}),i.appendChild(p),e.length>0&&e[0].type==="word_types"&&!n){const f=document.createElement("div");f.className="word-types-legend",f.innerHTML=`
            <div class="legend-item" data-type="noun" onclick="setActiveWordType('noun')"><div class="legend-color" style="background:red"></div> ${v.ui.wordTypesLegend.noun}</div>
            <div class="legend-item" data-type="verb" onclick="setActiveWordType('verb')"><div class="legend-color" style="background:blue"></div> ${v.ui.wordTypesLegend.verb}</div>
            <div class="legend-item" data-type="adj" onclick="setActiveWordType('adj')"><div class="legend-color" style="background:green"></div> ${v.ui.wordTypesLegend.adj}</div>
            <div class="legend-item" data-type="artikel" onclick="setActiveWordType('artikel')"><div class="legend-color" style="background:orange"></div> ${v.ui.wordTypesLegend.artikel}</div>
            <div class="legend-item" data-type="none" onclick="setActiveWordType('none')"><div class="legend-color" style="background:#888; height: 10px; width: 10px; border-radius: 2px;"></div> ${v.ui.wordTypesLegend.eraser}</div>
            <div style="font-style:italic; margin-left:10px;">${v.ui.wordTypesLegend.instruction}</div>
        `,i.insertBefore(f,p)}const m=document.createElement("div");return m.className="sheet-footer",s&&(m.textContent=`${s.current}${n?v.ui.solutionsSuffix:""}`),i.appendChild(m),i}var le=(function(){var a=String.fromCharCode,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function t(i,o){if(!s[i]){s[i]={};for(var l=0;l<i.length;l++)s[i][i.charAt(l)]=l}return s[i][o]}var r={compressToBase64:function(i){if(i==null)return"";var o=r._compress(i,6,function(l){return e.charAt(l)});switch(o.length%4){default:case 0:return o;case 1:return o+"===";case 2:return o+"==";case 3:return o+"="}},decompressFromBase64:function(i){return i==null?"":i==""?null:r._decompress(i.length,32,function(o){return t(e,i.charAt(o))})},compressToUTF16:function(i){return i==null?"":r._compress(i,15,function(o){return a(o+32)})+" "},decompressFromUTF16:function(i){return i==null?"":i==""?null:r._decompress(i.length,16384,function(o){return i.charCodeAt(o)-32})},compressToUint8Array:function(i){for(var o=r.compress(i),l=new Uint8Array(o.length*2),d=0,c=o.length;d<c;d++){var u=o.charCodeAt(d);l[d*2]=u>>>8,l[d*2+1]=u%256}return l},decompressFromUint8Array:function(i){if(i==null)return r.decompress(i);for(var o=new Array(i.length/2),l=0,d=o.length;l<d;l++)o[l]=i[l*2]*256+i[l*2+1];var c=[];return o.forEach(function(u){c.push(a(u))}),r.decompress(c.join(""))},compressToEncodedURIComponent:function(i){return i==null?"":r._compress(i,6,function(o){return n.charAt(o)})},decompressFromEncodedURIComponent:function(i){return i==null?"":i==""?null:(i=i.replace(/ /g,"+"),r._decompress(i.length,32,function(o){return t(n,i.charAt(o))}))},compress:function(i){return r._compress(i,16,function(o){return a(o)})},_compress:function(i,o,l){if(i==null)return"";var d,c,u={},p={},m="",f="",g="",b=2,k=3,w=2,S=[],y=0,x=0,_;for(_=0;_<i.length;_+=1)if(m=i.charAt(_),Object.prototype.hasOwnProperty.call(u,m)||(u[m]=k++,p[m]=!0),f=g+m,Object.prototype.hasOwnProperty.call(u,f))g=f;else{if(Object.prototype.hasOwnProperty.call(p,g)){if(g.charCodeAt(0)<256){for(d=0;d<w;d++)y=y<<1,x==o-1?(x=0,S.push(l(y)),y=0):x++;for(c=g.charCodeAt(0),d=0;d<8;d++)y=y<<1|c&1,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=c>>1}else{for(c=1,d=0;d<w;d++)y=y<<1|c,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=0;for(c=g.charCodeAt(0),d=0;d<16;d++)y=y<<1|c&1,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=c>>1}b--,b==0&&(b=Math.pow(2,w),w++),delete p[g]}else for(c=u[g],d=0;d<w;d++)y=y<<1|c&1,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=c>>1;b--,b==0&&(b=Math.pow(2,w),w++),u[f]=k++,g=String(m)}if(g!==""){if(Object.prototype.hasOwnProperty.call(p,g)){if(g.charCodeAt(0)<256){for(d=0;d<w;d++)y=y<<1,x==o-1?(x=0,S.push(l(y)),y=0):x++;for(c=g.charCodeAt(0),d=0;d<8;d++)y=y<<1|c&1,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=c>>1}else{for(c=1,d=0;d<w;d++)y=y<<1|c,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=0;for(c=g.charCodeAt(0),d=0;d<16;d++)y=y<<1|c&1,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=c>>1}b--,b==0&&(b=Math.pow(2,w),w++),delete p[g]}else for(c=u[g],d=0;d<w;d++)y=y<<1|c&1,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=c>>1;b--,b==0&&(b=Math.pow(2,w),w++)}for(c=2,d=0;d<w;d++)y=y<<1|c&1,x==o-1?(x=0,S.push(l(y)),y=0):x++,c=c>>1;for(;;)if(y=y<<1,x==o-1){S.push(l(y));break}else x++;return S.join("")},decompress:function(i){return i==null?"":i==""?null:r._decompress(i.length,32768,function(o){return i.charCodeAt(o)})},_decompress:function(i,o,l){var d=[],c=4,u=4,p=3,m="",f=[],g,b,k,w,S,y,x,_={val:l(0),position:o,index:1};for(g=0;g<3;g+=1)d[g]=g;for(k=0,S=Math.pow(2,2),y=1;y!=S;)w=_.val&_.position,_.position>>=1,_.position==0&&(_.position=o,_.val=l(_.index++)),k|=(w>0?1:0)*y,y<<=1;switch(k){case 0:for(k=0,S=Math.pow(2,8),y=1;y!=S;)w=_.val&_.position,_.position>>=1,_.position==0&&(_.position=o,_.val=l(_.index++)),k|=(w>0?1:0)*y,y<<=1;x=a(k);break;case 1:for(k=0,S=Math.pow(2,16),y=1;y!=S;)w=_.val&_.position,_.position>>=1,_.position==0&&(_.position=o,_.val=l(_.index++)),k|=(w>0?1:0)*y,y<<=1;x=a(k);break;case 2:return""}for(d[3]=x,b=x,f.push(x);;){if(_.index>i)return"";for(k=0,S=Math.pow(2,p),y=1;y!=S;)w=_.val&_.position,_.position>>=1,_.position==0&&(_.position=o,_.val=l(_.index++)),k|=(w>0?1:0)*y,y<<=1;switch(x=k){case 0:for(k=0,S=Math.pow(2,8),y=1;y!=S;)w=_.val&_.position,_.position>>=1,_.position==0&&(_.position=o,_.val=l(_.index++)),k|=(w>0?1:0)*y,y<<=1;d[u++]=a(k),x=u-1,c--;break;case 1:for(k=0,S=Math.pow(2,16),y=1;y!=S;)w=_.val&_.position,_.position>>=1,_.position==0&&(_.position=o,_.val=l(_.index++)),k|=(w>0?1:0)*y,y<<=1;d[u++]=a(k),x=u-1,c--;break;case 2:return f.join("")}if(c==0&&(c=Math.pow(2,p),p++),d[x])m=d[x];else if(x===u)m=b+b.charAt(0);else return null;f.push(m),d[u++]=b+m.charAt(0),c--,b=m,c==0&&(c=Math.pow(2,p),p++)}}};return r})();typeof define=="function"&&define.amd?define(function(){return le}):typeof oe<"u"&&oe!=null&&(oe.exports=le);let $=[],T=null,P="",J="1",R="";const Ce={married_100:[{key:"marriedMultiplesOf10",type:"checkbox",labelKey:"marriedMultiplesOf10"}],money_10:[{key:"currency",type:"select",options:["CHF","EUR"],labelKey:"currency"}],money_100:[{key:"currency",type:"select",options:["CHF","EUR"],labelKey:"currency"}]};function Qe(){Xe(),Ke(),H()}function q(){localStorage.setItem("ufzgiblatt_builder_problems",JSON.stringify($)),localStorage.setItem("ufzgiblatt_builder_title",P),D()}function Xe(){try{const a=localStorage.getItem("ufzgiblatt_builder_problems");a&&($=JSON.parse(a),$.forEach(e=>{e.params||(e.params={options:e.problemData.options||{},currency:e.problemData.currency||"CHF"})})),P=localStorage.getItem("ufzgiblatt_builder_title")||""}catch(a){console.warn("Failed to load builder state:",a)}}function Ke(){if(xe(),!R){const a=W[J];a&&a.length>0&&(R=a[0])}_e()}window.updateBuilderTitle=function(a){P=a,q()};function xe(){const a=document.getElementById("builderGradeTabs");if(!a)return;a.innerHTML="";const e=window.T&&window.T.ui&&window.T.ui.grades?window.T:typeof v<"u"?v:null;e&&Object.keys(W).forEach(n=>{const s=document.createElement("div");s.className=`grade-tab ${n===J?"active":""}`,s.textContent=e.ui.grades[n],s.onclick=()=>Ye(n),a.appendChild(s)})}function Ye(a){if(J===a)return;J=a;const e=W[a]||[];R=e.length>0?e[0]:"",xe(),_e(),D()}function _e(){const a=document.getElementById("builderTopicChips");if(!a)return;a.innerHTML="";const e=W[J]||[],n=window.T&&window.T.topics?window.T:typeof v<"u"?v:null;n&&(e.forEach(s=>{const t=document.createElement("div");t.className=`topic-chip ${s===R?"active":""}`,t.textContent=n.topics[s]||s,t.dataset.topic=s,t.draggable=!0,t.ondragstart=r=>{r.dataTransfer&&(r.dataTransfer.effectAllowed="copyMove",r.dataTransfer.setData("application/x-ufzgiblatt-topic",s)),pe(s),T=t,T.dataset.isNewTopic="true",T.dataset.topicKey=s},t.ondragend=()=>{T=null,document.querySelectorAll(".drop-indicator").forEach(r=>r.style.display="none")},t.onclick=()=>pe(s),t.ondblclick=()=>{pe(s),window.addProblemToBuilder()},a.appendChild(t)}),De())}function Ze(){const a=document.getElementById("builderTopicChips");if(!a)return;a.querySelectorAll(".topic-chip").forEach(n=>{n.dataset.topic===R?n.classList.add("active"):n.classList.remove("active")})}function pe(a){R!==a&&(R=a,Ze(),De(),D())}function De(){const a=document.getElementById("builderTopicOptions");if(!a)return;if(a.innerHTML="",!R){a.style.display="none";return}const e=Ce[R];e&&e.length>0?(a.style.display="flex",e.forEach(n=>{const s=document.createElement("div");s.className="option-group";const t=document.createElement("label"),r=window.T||v;if(t.textContent=r.ui.builder.options?.[n.labelKey]||n.labelKey,n.type==="checkbox"){const i=document.createElement("input");i.type="checkbox",i.id=`opt_${n.key}`,i.addEventListener("change",()=>D()),s.appendChild(i),s.appendChild(t)}else if(n.type==="select"){const i=document.createElement("select");i.id=`opt_${n.key}`,i.addEventListener("change",()=>D()),n.options.forEach(o=>{const l=document.createElement("option");l.value=o,l.textContent=o,i.appendChild(l)}),s.appendChild(t),s.appendChild(i)}a.appendChild(s)})):a.style.display="none"}function ue(){const a=R;if(!a)return{};const e={},n=Ce[a];return n&&n.forEach(s=>{const t=document.getElementById(`opt_${s.key}`);t&&(e[s.key]=t.type==="checkbox"?t.checked:t.value)}),e}window.addProblemToBuilder=function(){const a=R;if(!a)return;const e=ue(),n=ke(a,e);$.push(n),q(),H()};function ke(a,e,n,s,t){const r=e.currency||"CHF",i=Ae(a,r,e,-1,window.lang||"de"),o=i?.weight||36;return{id:Date.now()+Math.random().toString(36).substr(2,9),type:a,problemData:i,weight:o,params:{options:e,currency:r},gridX:n,gridY:s,page:t}}window.copyBuilderLink=function(){const a=Re(),e=new URL(window.location.href);e.hash=`build=${a}`,navigator.clipboard.writeText(e.toString()).then(()=>{const n=window.T||v;alert(n.ui.builder.linkCopied||"Link kopiert!")})};function Re(){const e={d:$.map(s=>{const t={...s.problemData};return delete t.weight,delete t.span,delete t.moduleType,t.type==="standard"&&delete t.type,{t:s.type,d:t,p:s.params,x:s.gridX,y:s.gridY,pg:s.page}}),t:P,g:J,tp:R,o:ue(),s:document.getElementById("builderSolutionToggle")?.checked?1:0,q:document.getElementById("builderShowQR")?.checked??1?1:0},n=JSON.stringify(e);return le.compressToEncodedURIComponent(n)}function Je(){return Re()}function Ve(){return $?$.length>0||!!P&&P.trim()!=="":!1}function et(a){try{let e=le.decompressFromEncodedURIComponent(a);if(!e||!e.startsWith("{")&&!e.startsWith("["))try{e=decodeURIComponent(escape(atob(a)))}catch{console.warn("Failed to decode legacy hash.")}if(!e)return;const n=JSON.parse(e);let s=[];if(Array.isArray(n))s=n;else if(s=n.d||[],P=n.t||"",n.g&&(J=n.g),n.tp){if(R=n.tp,xe(),_e(),n.s!==void 0){const t=document.getElementById("builderSolutionToggle");t&&(t.checked=!!n.s)}if(n.q!==void 0){const t=document.getElementById("builderShowQR");t&&(t.checked=!!n.q)}n.o&&setTimeout(()=>{Object.entries(n.o).forEach(([t,r])=>{const i=document.getElementById(`opt_${t}`);i&&(i.type==="checkbox"?i.checked=!!r:i.value=r)})},0)}$=s.map(t=>{const r=F[t.t]||F.default,i={...t.d};return i.weight=r.weight,i.span=r.span,i.moduleType=t.t,i.type||(i.type="standard"),{id:Date.now()+Math.random().toString(36).substr(2,9),type:t.t,problemData:i,weight:r.weight,params:t.p,gridX:t.x,gridY:t.y,page:t.pg}}),q(),H()}catch(e){console.error("Failed to load builder state:",e)}}window.duplicateProblem=function(a){const e=$.find(s=>s.id===a);if(!e)return;const n=JSON.parse(JSON.stringify(e));n.id=Date.now()+Math.random().toString(36).substr(2,9),delete n.gridX,delete n.gridY,delete n.page,$.push(n),q(),H()};window.clearBuilder=function(){const a=window.T||v;confirm(a.ui.confirmDelete||"Are you sure?")&&($=[],P="",q(),H())};window.refreshBuilderSeed=function(){const a=Math.floor(Math.random()*4294967295);ne(a),$.forEach(e=>{const n=e.params||{options:{},currency:"CHF"},s=n.options||{},t=n.currency||"CHF";e.problemData=Ae(e.type,t,s,-1,window.lang||"de")}),q(),H()};window.removeProblem=function(a){$=$.filter(e=>e.id!==a),q(),H()};function H(){window.renderBuilderSheet=H;try{const a=document.getElementById("builderSheetsWrapper");if(!a)return;a.innerHTML="";let e=[[]];const n=$.filter(c=>c.page!==void 0),s=$.filter(c=>c.page===void 0),t=n.reduce((c,u)=>Math.max(c,u.page||0),0);for(let c=0;c<=t;c++)e[c]=n.filter(u=>u.page===c);e.length===0&&(e=[[]]);let r=e.length-1,i=e[r].reduce((c,u)=>c+u.weight,0);s.forEach(c=>{i+c.weight>we&&e[r].length>0&&(e.push([]),r++,i=0),e[r].push(c),i+=c.weight});const o=document.getElementById("builderSolutionToggle")?.checked||!1,l=document.getElementById("builderShowQR")?.checked??!0,d=(c,u,p)=>{const m=c.map(E=>E.problemData),f={current:u+1,total:e.length};let g=window.T&&window.T.ui&&window.T.ui.builder?window.T.ui.builder.title:"Arbeitsblatt (Baukasten)";P&&P.trim()!==""&&(g=P);const b=fe(g,m,p,f,!p),k=b.querySelector(".qr-code-container");k&&(l?k.classList.remove("qr-hidden"):k.classList.add("qr-hidden"));const w=b.querySelector(".problem-grid"),S=Array(45).fill(null).map(()=>Array(12).fill(!1)),y=(E,j,A,U)=>{if(E<1||j<1||E+U-1>45||j+A-1>12)return!1;for(let N=0;N<U;N++)for(let B=0;B<A;B++)if(S[E+N-1][j+B-1])return!1;return!0},x=(E,j,A,U)=>{for(let N=0;N<U;N++)for(let B=0;B<A;B++)E+N-1<45&&j+B-1<12&&(S[E+N-1][j+B-1]=!0)};if(c.forEach(E=>{if(E.gridX!==void 0&&E.gridY!==void 0){const j=E.problemData.span||12,A=Math.max(1,Math.round(E.weight/(j||1)));x(E.gridY,E.gridX,j,A)}}),b.querySelectorAll(".problem").forEach((E,j)=>{const A=c[j],U=A.problemData.span||12,N=Math.max(1,Math.round(A.weight/(U||1)));let B=A.gridX,te=A.gridY;if(B===void 0||te===void 0){let K=!1;for(let z=1;z<=45;z++){for(let Q=1;Q<=12;Q++)if(y(z,Q,U,N)){B=Q,te=z,x(z,Q,U,N),K=!0,A.gridX=B,A.gridY=te;break}if(K)break}}const I=document.createElement("div");if(I.className=p?"solution-problem-wrapper":"builder-problem-wrapper",p||(I.draggable=!0,I.dataset.id=A.id),B!==void 0&&te!==void 0&&(I.style.gridArea=`${te} / ${B} / span ${N} / span ${U}`),!p){const K=document.createElement("button");K.className="btn-remove-problem",K.innerHTML="‚úñ",K.onclick=Y=>{Y.stopPropagation(),window.removeProblem(A.id)},I.appendChild(K);const z=document.createElement("button");z.className="btn-duplicate-problem",z.innerHTML="üìë",z.title="Duplizieren",z.onclick=Y=>{Y.stopPropagation(),window.duplicateProblem(A.id)},I.appendChild(z);const Q=document.createElement("div");Q.className="resize-handle no-print",Q.onmousedown=Y=>{Y.stopPropagation(),Y.preventDefault(),window.initResize(Y,A.id)},I.appendChild(Q),I.addEventListener("dragstart",tt),I.addEventListener("dragenter",nt),I.addEventListener("dragover",Ee),I.addEventListener("dragleave",it),I.addEventListener("drop",Me),I.addEventListener("dragend",ot)}E.parentNode?.insertBefore(I,E),I.appendChild(E)}),w&&!p&&(w.dataset.pageIdx=u.toString(),w.addEventListener("dragover",Ee),w.addEventListener("drop",Me),w.addEventListener("dragleave",at),!w.querySelector(".drop-indicator"))){const E=document.createElement("div");E.className="drop-indicator",E.style.pointerEvents="none",w.appendChild(E)}return b};e.forEach((c,u)=>{a.appendChild(d(c,u,!1))}),o&&e.forEach((c,u)=>{a.appendChild(d(c,u,!0))}),D(),typeof window.autoScaleSheet=="function"&&window.autoScaleSheet()}catch(a){console.error("Render Error:",a)}}function tt(a){this.classList.add("dragging"),T=this,T.dataset.isNewTopic="false",a.dataTransfer&&(a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",this.dataset.id||""))}function Ee(a){a.preventDefault&&a.preventDefault(),a.dataTransfer&&(T&&T.dataset.isNewTopic==="true"?a.dataTransfer.dropEffect="copy":a.dataTransfer.dropEffect="move");let e=a.target.closest(".problem-grid");if(!e){const l=document.querySelectorAll(".problem-grid");for(const d of l){const c=d.getBoundingClientRect();if(a.clientX>=c.left&&a.clientX<=c.right&&a.clientY>=c.top&&a.clientY<=c.bottom){e=d;break}}}if(!e||!T)return!1;const n=e.getBoundingClientRect(),s=n.width/12,t=n.height/45,r=Math.min(12,Math.max(1,Math.floor((a.clientX-n.left)/s)+1)),i=Math.min(45,Math.max(1,Math.floor((a.clientY-n.top)/t)+1)),o=e.querySelector(".drop-indicator");if(o){let l=0,d=0,c="";if(T&&T.dataset.isNewTopic==="false"){c=T.dataset.id||"";const u=$.find(p=>p.id===c);u&&(l=u.problemData.span||12,d=Math.max(1,Math.round(u.weight/(l||1))))}else if(T&&T.dataset.isNewTopic==="true"){c="new_"+T.dataset.topicKey;const u=ue(),p=T.dataset.topicKey||"",m=ke(p,u);l=m.problemData.span||12,d=Math.max(1,Math.round(m.weight/(l||1)))}if(l&&d){const u=Math.min(r,12-l+1),p=Math.min(i,45-d+1);if(o.style.display="flex",o.style.left=`${(u-1)*(100/12)}%`,o.style.top=`${(p-1)*t}px`,o.style.width=`${l*(100/12)}%`,o.style.height=`${d*t}px`,o.dataset.previewId!==c){if(o.innerHTML="",c.startsWith("new_")){const b=document.createElement("div");b.style.width="100%",b.style.height="100%",b.style.display="flex",b.style.alignItems="center",b.style.justifyContent="center",b.style.backgroundColor="rgba(66, 133, 244, 0.2)",b.style.border="2px dashed #4285f4",b.style.borderRadius="8px",b.style.color="#333",b.style.fontWeight="bold",b.textContent=T.textContent,o.appendChild(b)}else{const b=T.querySelector(".problem");if(b){const k=b.cloneNode(!0);k.querySelectorAll("input").forEach(w=>{w.readOnly=!0,w.removeAttribute("name"),w.removeAttribute("id")}),o.appendChild(k)}}o.dataset.previewId=c}const m=parseInt(e.dataset.pageIdx||"0"),f={x:u,y:p,w:l,h:d};let g=!1;$.forEach(b=>{if(!(T?.dataset.isNewTopic==="false"&&b.id===T?.dataset.id)&&b.page===m&&b.gridX!==void 0&&b.gridY!==void 0){const k=b.problemData.span||12,w=Math.max(1,Math.round(b.weight/k)),S={x:b.gridX,y:b.gridY,w:k,h:w};f.x+f.w-1<S.x||f.x>S.x+S.w-1||f.y+f.h-1<S.y||f.y>S.y+S.h-1||(g=!0)}}),g?o.classList.add("overlap"):o.classList.remove("overlap")}}return!1}function nt(a){this.classList.add("drag-over")}function it(a){this.classList.remove("drag-over")}function at(a){if(a.relatedTarget&&this.contains(a.relatedTarget))return;const e=this.querySelector(".drop-indicator");e&&(e.style.display="none")}function rt(){document.querySelectorAll(".problem-grid").forEach(e=>{const n=parseInt(e.dataset.pageIdx||"0");if(isNaN(n))return;const s=e.getBoundingClientRect(),t=s.width/12,r=s.height/45;e.querySelectorAll(".builder-problem-wrapper").forEach(o=>{const l=o.dataset.id,d=$.find(g=>g.id===l);if(!d||d.gridX!==void 0&&d.gridY!==void 0&&d.page!==void 0)return;const c=o.getBoundingClientRect(),u=c.left-s.left,p=c.top-s.top;let m=Math.round(u/t)+1,f=Math.round(p/r)+1;m=Math.max(1,Math.min(12,m)),f=Math.max(1,Math.min(45,f)),d.gridX=m,d.gridY=f,d.page=n})})}function Me(a){try{a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),rt();let e=a.target.closest(".problem-grid");if(!e){const m=a.target.closest(".sheet");m&&(e=m.querySelector(".problem-grid"))}if(!e)return!1;const n=parseInt(e.dataset.pageIdx||"0"),s=e.getBoundingClientRect(),t=s.width/12,r=s.height/45,i=Math.min(12,Math.max(1,Math.floor((a.clientX-s.left)/t)+1)),o=Math.min(45,Math.max(1,Math.floor((a.clientY-s.top)/r)+1));let l=a.dataTransfer?.getData("application/x-ufzgiblatt-topic");if(!l&&T&&T.dataset.isNewTopic==="true"&&(l=T.dataset.topicKey),l){const m=ue(),f=ke(l,m),g=f.problemData.span||12,b=Math.max(1,Math.round(f.weight/(g||1)));return f.gridX=Math.min(i,12-g+1),f.gridY=Math.min(o,45-b+1),f.page=n,$.push(f),q(),H(),!1}const d=a.dataTransfer?.getData("text/plain")||(T?T.dataset.id:null),c=$.find(m=>m.id===d);if(!c)return!1;const u=c.problemData.span||12,p=Math.max(1,Math.round(c.weight/(u||1)));c.gridX=Math.min(i,12-u+1),c.gridY=Math.min(o,45-p+1),c.page=n,q(),H()}catch(e){console.error("Builder Drop Error:",e)}return!1}function ot(a){this.classList.remove("dragging"),document.querySelectorAll(".drop-indicator").forEach(e=>e.style.display="none"),document.querySelectorAll(".builder-problem-wrapper").forEach(e=>e.classList.remove("drag-over"))}window.initResize=function(a,e){const n=$.find(p=>p.id===e);if(!n)return;const s=a.clientX,t=n.problemData.span||12,r=n.weight,i=t/r,o=document.querySelector(`.problem-grid[data-page-idx="${n.page}"]`);if(!o)return;const d=o.getBoundingClientRect().width/12,c=p=>{const m=p.clientX-s,f=Math.round(m/d);let g=t+f;g<1&&(g=1),g>12-(n.gridX||1)+1&&(g=12-(n.gridX||1)+1);const b=document.querySelector(`.builder-problem-wrapper[data-id="${e}"]`);if(b){const k=Math.round(g/i),w=Math.max(1,Math.round(k/g));b.style.gridArea=`${n.gridY} / ${n.gridX} / span ${w} / span ${g}`}},u=p=>{window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",u);const m=p.clientX-s,f=Math.round(m/d);let g=t+f;g<1&&(g=1),g>12-(n.gridX||1)+1&&(g=12-(n.gridX||1)+1),n.problemData.span=g,n.weight=Math.round(g/i),n.problemData.weight!==void 0&&(n.problemData.weight=n.weight),q(),H()};window.addEventListener("mousemove",c),window.addEventListener("mouseup",u)};class st extends G{constructor(e){super(e)}render(e,n,s){const{a:t,b:r,op:i,answer:o}=this.data,l=n?o:"",d=this.span;e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.gap=d<=3?"8px":"15px";const c=d<=3?"50px":"65px";if(e.innerHTML=`
            <span class="number">${t}</span>
            <span class="operator">${i}</span>
            <span class="number">${r}</span>
            <span class="equals">=</span>
            <input type="number" class="answer-input" style="width:${c}; text-align:center;" 
                data-expected="${o}" value="${l}" 
                oninput="validateInput(this)" ${n?"readonly":""}>
        `,this.data.hasGrid){e.style.flexDirection="column",e.style.alignItems="flex-start";const u=document.createElement("div");u.className="squared-grid",e.appendChild(u)}}static generate(e,n,s){let t=0,r=0,i="",o={type:"standard"};switch(e){case"add_10":t=h(0,9),r=h(1,10-t),i="+";break;case"sub_10":t=h(1,10),r=h(1,t),i="-";break;case"add_20_simple":t=h(10,22),r=h(1,23-t),i="+";break;case"sub_20_simple":t=h(11,24),r=h(1,t-10),i="-";break;case"add_20":t=h(1,23),r=h(1,24-t),i="+";break;case"sub_20":t=h(1,24),r=h(1,t),i="-";break;case"add_100_simple":t=h(1,89);{let l=t%10;for(r=h(1,99-t);r%10+l>=10;)r=h(1,99-t)}i="+";break;case"add_100_carry":do t=h(10,89),r=h(1,99-t);while(t%10+r%10<10);i="+";break;case"sub_100_simple":t=h(10,99);{let l=t%10,d=Math.floor(t/10),c=h(0,d),u=h(0,l);r=c*10+u,r===0&&(r=1)}i="-";break;case"sub_100_carry":do t=h(20,99),r=h(1,t-1);while(t%10>=r%10);i="-";break;case"mult_2_5_10":r=[2,5,10][h(0,2)],t=h(1,10),i="√ó";break;case"mult_all":t=h(1,10),r=h(1,10),i="√ó";break;case"div_2_5_10":{let l=[2,5,10][h(0,2)];t=h(1,10)*l,r=l}i=":";break;case"add_1000":t=h(100,899),r=h(1,999-t),i="+",o.hasGrid=!0;break;case"sub_1000":t=h(100,999),r=h(1,t-1),i="-",o.hasGrid=!0;break;case"mult_advanced":t=h(11,20),r=h(2,6),i="√ó";break;case"div_100":{let l=h(2,9);t=h(2,10)*l,r=l}i=":";break;case"dec_add":{let l=h(100,9999)/100,d=h(100,9999)/100;t=l,r=d,i="+",o.answer=parseFloat((l+d).toFixed(2))}break;case"dec_sub":{let l=h(500,9999)/100,d=h(100,499)/100;t=l,r=d,i="-",o.answer=parseFloat((l-d).toFixed(2))}break;case"mult_10_100":t=h(10,9999)/100,r=[10,100,1e3][h(0,2)],i="√ó",o.answer=Math.round(t*r*1e3)/1e3;break}return o.a=t,o.b=r,o.op=i,o.answer===void 0&&(i==="+"?o.answer=t+r:i==="-"?o.answer=t-r:i==="√ó"?o.answer=t*r:i===":"&&(o.answer=t/r)),o}}class lt extends G{constructor(e){super(e)}render(e,n,s){const t=this.data.values,r=this.data.mask,i=this.data.levels||3,o=p=>{if(p>=t.length)return"";const m=t[p];return r[p]?`<div class="brick input"><input type="number" class="brick-input answer-input"
                    data-expected="${m}"
                    value="${n?m:""}"
                    oninput="validateInput(this)"
                    ${n?"readonly":""} style="${n?"color:var(--primary-color); font-weight:bold;":""}"></div>`:`<div class="brick">${m}</div>`};let l='<div class="pyramid-container">',d=0,c=[],u=i;for(let p=0;p<i;p++)c.push(d),d+=u,u--;for(let p=i-1;p>=0;p--){let m=c[p],f=i-p;l+='<div class="pyramid-row">';for(let g=0;g<f;g++)l+=o(m+g);l+="</div>"}l+="</div>",e.innerHTML=l,e.style.display="flex",e.style.justifyContent="center",e.style.padding="0",e.style.border="none"}static generate(e,n,s){let t=100,r=3;return e==="rechenmauer_10"?t=10:e==="rechenmauer_100"?(t=200,r=3):e==="rechenmauer_4"?(t=100,r=4):e==="rechenmauer"&&(t=100,r=3),this.generatePyramid(t,r)}static generatePyramid(e,n=3){let s=[],t;do{s=[];let m=n,f=Math.max(1,Math.floor(e/2**(n-1)));for(let k=0;k<m;k++)s.push(h(1,f));let g=0,b=m;for(let k=1;k<n;k++){for(let w=0;w<b-1;w++){let S=s[g+w]+s[g+w+1];s.push(S)}g+=b,b--}t=s[s.length-1]}while(t>e);const r=s.length,i=this.getPyramidRelations(n),o=Math.floor(r*.4),l=Math.floor(r*.6);let d=h(o,l);n===3&&(d=3),n===4&&(d=6);let c=[],u=!1,p=0;for(;!u&&p<200;){c=new Array(r).fill(!1);let m=0,f=d;for(p>50&&(f=Math.max(1,d-1)),p>100&&(f=Math.max(1,d-2));m<f;){let g=h(0,r-1);c[g]||(c[g]=!0,m++)}this.checkPyramidSolvable(i,r,c)?u=!0:p++}return u||c.fill(!1),{type:"pyramid",values:s,mask:c,levels:n}}static getPyramidRelations(e){const n=[];let s=0,t=e;for(let r=0;r<e-1;r++){for(let i=0;i<t-1;i++){const o=s+i,l=s+i+1,d=s+t+i;n.push([d,o,l])}s+=t,t--}return n}static checkPyramidSolvable(e,n,s){const t=s.map(i=>!i);let r=!0;for(;r;){r=!1;for(const[i,o,l]of e){const d=t[i],c=t[o],u=t[l];!d&&c&&u?(t[i]=!0,r=!0):d&&!c&&u?(t[o]=!0,r=!0):d&&c&&!u&&(t[l]=!0,r=!0)}}return t.every(i=>i)}}class dt extends G{constructor(e){super(e)}render(e,n,s){const t=this.span,r=n?"color:var(--primary-color); font-weight:bold;":"",i=n?"readonly":"";if(this.data.type==="missing_addend"||this.data.type==="married_numbers"){const{a:o,sum:l,op:d,answer:c}=this.data,u=n?c:"",p=t<=3?"5px":"15px",m=t<=3?"50px":"70px";e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.gap=p,e.innerHTML=`
                <span class="number">${o}</span>
                <span class="operator">${d||"+"}</span>
                <input type="number" class="answer-input" style="width:${m}; text-align:center; ${r}" 
                       data-expected="${c}" 
                       value="${u}"
                       oninput="validateInput(this)" ${i}>
                <span class="equals">=</span>
                <span class="number" style="text-align:left;">${l}</span>
            `}else if(this.data.type==="div_remainder"){const{a:o,b:l,op:d,answer:c,remainder:u}=this.data,p=n?c:"",m=n?u:"";e.innerHTML=`
                <span class="number">${o}</span>
                <span class="operator">${d}</span>
                <span class="number">${l}</span>
                <span class="equals">=</span>
                <input type="number" class="answer-input" style="width:40px; margin-right:5px; ${r}" 
                       data-expected="${c}" value="${p}" oninput="validateInput(this)" ${i}>
                <span style="font-size:12pt; margin-right:5px;">R</span>
                <input type="number" class="answer-input" style="width:40px; ${r}" 
                       data-expected="${u}" value="${m}" oninput="validateInput(this)" ${i}>
            `}else if(this.data.type==="doubling_halving"){const{subtype:o,val:l,answer:d}=this.data,c=window.TRANSLATIONS||{},u=window.lang||"de",p=c[u]||{},m=o==="double"?p.ui?.doubleLabel||"Das Doppelte":p.ui?.halfLabel||"Die H√§lfte",f=n?d:"";e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.gap="5px",e.innerHTML=`
                <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; line-height:1; margin-right:4px;">
                    <span style="font-weight:bold; font-size:0.75em; margin-bottom:2px;">${m}</span>
                    <span class="number" style="text-align:center; font-size:1.1em; width:auto;">${l}</span>
                </div>
                <span style="margin-right:2px; font-size:0.9em;">‚ûú</span>
                <input type="number" class="answer-input" style="width:50px; ${r}" 
                       data-expected="${d}" value="${f}" oninput="validateInput(this)" ${i}>
            `}else if(this.data.type==="rechenstrich"){const{start:o,jump1:l,mid:d,jump2:c,sum:u}=this.data,p=n?l:"",m=n?d:"",f=n?c:"",g=n?u:"";e.style.flexDirection="column",e.style.alignItems="center",e.style.padding="20px 0";const b=`<div style="font-size: 1.2rem; margin-bottom: 20px;">
                ${o} + ${(l||0)+(c||0)} = <input type="number" class="answer-input" style="width:70px;" data-expected="${u}" value="${g}" oninput="validateInput(this)" ${i} ${r}>
            </div>`,k=`
                <div class="rechenstrich-container" style="position:relative; width:300px; height:80px; margin-top:20px;">
                    <div style="position:absolute; top:50px; left:0; width:100%; height:2px; background:#000;"></div>
                    <div class="rechenstrich-station rechenstrich-fixed" style="left:0; top:55px;">${o}</div>
                    <svg style="position:absolute; top:10px; left:0; width:66.6%; height:40px; overflow:visible;">
                        <path d="M 0 40 Q 50 0 100 40" fill="none" stroke="var(--primary-color)" stroke-width="2" vector-effect="non-scaling-stroke" style="transform: scaleX(2); transform-origin: left;"></path>
                    </svg>
                    <div class="rechenstrich-jump" style="left:33.3%; top:15px;">
                        +<input type="number" class="rechenstrich-input small" data-expected="${l}" value="${p}" oninput="validateInput(this)" ${i} ${r}>
                    </div>
                    <div class="rechenstrich-station" style="left:66.6%; top:55px;">
                        <input type="number" class="rechenstrich-input" data-expected="${d}" value="${m}" oninput="validateInput(this)" ${i} ${r}>
                    </div>
                    <svg style="position:absolute; top:10px; left:66.6%; width:33.3%; height:40px; overflow:visible;">
                        <path d="M 0 40 Q 25 10 50 40" fill="none" stroke="var(--primary-color)" stroke-width="2" vector-effect="non-scaling-stroke" style="transform: scaleX(2); transform-origin: left;"></path>
                    </svg>
                    <div class="rechenstrich-jump" style="left:83.3%; top:15px;">
                        +<input type="number" class="rechenstrich-input small" data-expected="${c}" value="${f}" oninput="validateInput(this)" ${i} ${r}>
                    </div>
                    <div class="rechenstrich-station rechenstrich-fixed" style="left:100%; top:55px;">
                        <input type="number" class="rechenstrich-input" data-expected="${u}" value="${g}" oninput="validateInput(this)" ${i} ${r}>
                    </div>
                </div>
            `;e.innerHTML=b+k}}static generate(e,n,s){switch(e){case"bonds_10":{const t=h(0,10);return{type:"missing_addend",a:t,sum:10,op:"+",answer:10-t}}case"div_remainder":{let t=h(2,9),r=h(2,10),i=h(1,t-1);return{type:"div_remainder",a:r*t+i,b:t,op:":",answer:r,remainder:i}}case"doubling_halving":if(X()<.5){let r=h(1,50);return{type:"doubling_halving",subtype:"double",val:r,answer:r*2}}else{let r=h(1,50)*2;return{type:"doubling_halving",subtype:"halve",val:r,answer:r/2}}case"rechenstrich":{const t=h(10,60),r=h(11,39),i=t+r,o=Math.floor(r/10)*10,l=r%10;return{type:"rechenstrich",start:t,jump1:o,mid:t+o,jump2:l,sum:i}}case"married_100":return this.generateMarriedNumbers(n.marriedMultiplesOf10||!1)}}static generateMarriedNumbers(e){let n;return e?n=h(0,10)*10:n=h(1,99),{type:"married_numbers",a:n,sum:100,op:"+",answer:100-n}}}class ct extends G{constructor(e){super(e)}render(e,n,s){const t=n?"color:var(--primary-color); font-weight:bold;":"",r=n?"readonly":"";if(this.data.type==="time_reading"){const{hours:i,minutes:o,answer:l}=this.data,d=n?l:"";e.innerHTML=this.renderClock(i,o)+`<input type="text" class="answer-input" style="width:60px; margin-left:10px; ${t}" 
                        placeholder="HH:MM" data-expected="${l}" value="${d}" oninput="validateInput(this)" ${r}>`}else if(this.data.type==="time_analog_set"){const{hours:i,minutes:o,digital:l}=this.data;e.innerHTML=`<div style="text-align:center; font-weight:bold; margin-bottom:5px;">${l}</div>`+this.renderClock(i,o,!n)}else if(this.data.type==="time_duration"){const{q:i,answer:o}=this.data,l=n?o:"";e.style.flexDirection="column",e.innerHTML=`<div style="margin-bottom:10px; text-align:center;">${i}</div>
                <input type="text" class="answer-input" style="width:80px; ${t}" 
                       placeholder="HH:MM" data-expected="${o}" value="${l}" oninput="validateInput(this)" ${r}>`}else if(this.data.type==="visual_add_100"){const{grid:i,total:o}=this.data,l=n?o:"";e.style.flexDirection="column",e.style.gap="10px";let d='<div class="hundred-grid">';i?.forEach(c=>{const u=c===0?"":`filled color-${c}`;d+=`<div class="grid-cell ${u}"></div>`}),d+="</div>",e.innerHTML=d+`<div style="display:flex; align-items:center; gap:5px;">
                    Total: <input type="number" class="answer-input" style="width:50px; ${t}" 
                                  data-expected="${o}" value="${l}" oninput="validateInput(this)" ${r}>
                 </div>`}else if(this.data.type==="unit_conv"){const{val:i,from:o,to:l,answer:d}=this.data,c=n?d:"";e.innerHTML=`<span>${i} ${o}</span> <span class="equals">=</span> 
                <input type="number" class="answer-input" style="width:70px; ${t}" 
                       data-expected="${d}" value="${c}" oninput="validateInput(this)" ${r}> <span>${l}</span>`}else if(this.data.type==="percent"){const{rate:i,base:o,answer:l}=this.data,d=n?l:"";e.innerHTML=`<span>${i}% von ${o}</span> <span class="equals">=</span> 
                <input type="number" class="answer-input" style="width:70px; ${t}" 
                       data-expected="${l}" value="${d}" oninput="validateInput(this)" ${r}>`}}renderClock(e,n,s=!1){const t=n*6,r=e%12*30+n*.5,i=s?0:1;return`
            <div class="clock">
                <div class="clock-face">
                    ${[12,1,2,3,4,5,6,7,8,9,10,11].map(o=>`<div class="hour-mark mark-${o}">${o}</div>`).join("")}
                    <div class="hand hour-hand" style="transform: rotate(${r}deg); opacity: ${i}"></div>
                    <div class="hand minute-hand" style="transform: rotate(${t}deg); opacity: ${i}"></div>
                    <div class="clock-center"></div>
                </div>
            </div>`}static generate(e,n,s){switch(e){case"time_reading":{const t=h(0,11)*5,r=h(1,12),i=t.toString().padStart(2,"0");return{type:"time_reading",hours:r,minutes:t,answer:`${r}:${i}`}}case"time_analog_set":{const t=h(0,3)*15,r=h(1,12),i=t.toString().padStart(2,"0");return{type:"time_analog_set",hours:r,minutes:t,digital:`${r}:${i}`}}case"time_analog_set_complex":{const t=h(0,59),r=h(0,23),i=r.toString().padStart(2,"0"),o=t.toString().padStart(2,"0");return{type:"time_analog_set",hours:r,minutes:t,digital:`${i}:${o}`,isComplex:!0}}case"time_duration":{const t=h(6,18),r=h(0,11)*5,i=h(1,12)*5;let o=r+i,l=t;o>=60&&(l+=Math.floor(o/60),o%=60);const d=t.toString(),c=r.toString().padStart(2,"0"),u=l.toString(),p=o.toString().padStart(2,"0");return{type:"time_duration",q:((window.TRANSLATIONS||{})[s||"de"]?.ui?.timeReadingQuestion||"It is {time}. What time is it in {duration} min?").replace("{time}",`${d}:${c}`).replace("{duration}",i.toString()),answer:`${u}:${p}`}}case"visual_add_100":{const t=h(20,100),r=h(2,3),i=[];let o=0;for(let c=0;c<r-1;c++){const u=t-o-(r-1-c),p=h(1,u);i.push(p),o+=p}i.push(t-o);const l=new Array(100).fill(0);let d=0;return i.forEach((c,u)=>{const p=u+1;for(let m=0;m<c;m++)d<100&&(l[d]=p,d++)}),{type:"visual_add_100",grid:l,parts:i,total:t}}case"units":{const t=[{from:"m",to:"cm",factor:100},{from:"km",to:"m",factor:1e3},{from:"kg",to:"g",factor:1e3},{from:"min",to:"s",factor:60},{from:"h",to:"min",factor:60}],r=t[h(0,t.length-1)];let i=h(1,20);return r.factor===1e3&&X()>.5&&(i=i/2),{type:"unit_conv",val:i,from:r.from,to:r.to,answer:i*r.factor}}case"percent_basic":{const t=[10,20,25,50,75],r=t[h(0,t.length-1)];let i=h(1,20)*100;return(r===25||r===75)&&(i=h(1,20)*4),{type:"percent",rate:r,base:i,answer:i*r/100}}}}}class ut extends G{constructor(e){super(e)}render(e,n,s){const t=n?"color:var(--primary-color); font-weight:bold;":"",r=n?"readonly":"";if(this.data.type==="text"){const{q:i,a:o}=this.data,l=n?o:"";e.style.flexDirection="column",e.style.alignItems="flex-start",e.innerHTML=`<p style="margin-bottom:10px;">${i}</p>
                <div style="display:flex; align-items:center; gap:5px;">
                    Answer: <input type="number" class="answer-input" style="width:60px; ${t}" 
                                   data-expected="${o}" value="${l}" oninput="validateInput(this)" ${r}>
                </div>`}else if(this.data.type==="word_types"){const i=this.data.sentence;e.style.flexDirection="column",e.className+=" word-types-problem";const o=window.TRANSLATIONS||{},l=window.lang||"de",d=o[l]?.ui?.wordTypesLegend||{};let c=`<div class="word-types-legend">
                <span class="legend-item noun" onclick="setWordTypeTool('noun')">${d.noun}</span>
                <span class="legend-item verb" onclick="setWordTypeTool('verb')">${d.verb}</span>
                <span class="legend-item adj" onclick="setWordTypeTool('adj')">${d.adj}</span>
                <span class="legend-item artikel" onclick="setWordTypeTool('artikel')">${d.artikel}</span>
                <span class="legend-item eraser" onclick="setWordTypeTool('eraser')">‚å´</span>
            </div>`,u='<div class="sentence-container">';i?.forEach(p=>{const m=n&&p.type!=="other"?`selected ${p.type}`:"";u+=`<span class="word ${m}" data-type="${p.type}" onclick="markWord(this)">${p.text}</span> `}),u+="</div>",e.innerHTML=c+u+`<p class="instruction" style="font-size:0.7em; margin-top:5px; color:#666;">${d.instruction||""}</p>`}}static generate(e,n,s){const t=window.TRANSLATIONS||{},r=s||"de";if(e==="word_problems"){const i=t[r]?.word_problems||[];if(i.length===0)return{type:"text",q:"No word problems found.",a:0};const o=i[h(0,i.length-1)];return{type:"text",q:o.q,a:o.a}}else if(e==="word_types"){const i=t[r]?.word_types||[],o=n.wordTypeIndex!==void 0?n.wordTypeIndex:-1;if(o>=0&&i.length>0)return{type:"word_types",sentence:i[o%i.length]};if(i.length>0)return{type:"word_types",sentence:i[h(0,i.length-1)]}}else if(e==="text")return{type:"text",q:"Sample generic text problem?",a:42}}}class pt extends G{constructor(e){super(e)}render(e,n,s){const{roof:t,floors:r}=this.data,i=n?"color:var(--primary-color); font-weight:bold;":"";let o='<div class="house-container">';o+=`<div class="house-roof">${t}</div>`,r.forEach(l=>{const d=l.hiddenSide===0&&!n?"":l.a,c=l.hiddenSide===1&&!n?"":l.b;o+=`
                <div class="house-floor">
                    <div class="house-room">
                        ${l.hiddenSide===0?`<input type="number" class="house-input answer-input" data-expected="${l.a}" value="${d}" oninput="validateInput(this)" ${n?"readonly":""} style="${i}">`:l.a}
                    </div>
                    <div class="house-room">
                        ${l.hiddenSide===1?`<input type="number" class="house-input answer-input" data-expected="${l.b}" value="${c}" oninput="validateInput(this)" ${n?"readonly":""} style="${i}">`:l.b}
                    </div>
                </div>`}),o+="</div>",e.innerHTML=o,e.style.display="flex",e.style.justifyContent="center"}static generate(e,n,s){let t=20;e==="zahlenhaus_10"&&(t=10),e==="zahlenhaus_100"&&(t=100);const r=h(10,t),i=3,o=[],l=new Set;for(let d=0;d<i;d++){let c=0,u=0;do c=h(0,r),u++;while(l.has(c)&&u<20);l.add(c);const p=r-c,m=X()<.5?0:1;o.push({a:c,b:p,hiddenSide:m})}return{type:"house",roof:r,floors:o}}}class ht extends G{constructor(e){super(e)}render(e,n,s){const{inner:t,outer:r,maskMode:i}=this.data,o=n?"color:var(--primary-color); font-weight:bold;":"",l=(d,c)=>c?`<input type="number" class="triangle-input answer-input" data-expected="${d}" value="${n?d:""}" oninput="validateInput(this)" ${n?"readonly":""} style="${o}">`:`<span class="triangle-val">${d}</span>`;e.innerHTML=`
            <div class="triangle-container">
                <svg viewBox="0 0 100 100" class="triangle-svg">
                    <path d="M 50 5 L 95 85 L 5 85 Z" fill="none" stroke="#ccc" stroke-width="1.5"></path>
                </svg>
                <div class="t-field t-inner-1">${l(t[0],i==="inner")}</div>
                <div class="t-field t-inner-2">${l(t[1],i==="inner")}</div>
                <div class="t-field t-inner-3">${l(t[2],i==="inner")}</div>
                <div class="t-field t-outer-1">${l(r[0],i==="outer")}</div>
                <div class="t-field t-outer-2">${l(r[1],i==="outer")}</div>
                <div class="t-field t-outer-3">${l(r[2],i==="outer")}</div>
            </div>`}static generate(e,n,s){let t=e==="rechendreiecke_100"?100:24,r=0,i=0,o=0,l=0,d=0,c=0,u=0;do{const m=Math.floor(t/1.5);r=h(1,m),i=h(1,m),o=h(1,m),l=r+i,d=i+o,c=o+r,u++}while((l>t||d>t||c>t)&&u<100);const p=X()<.5?"inner":"outer";return{type:"triangle",inner:[r,i,o],outer:[l,d,c],maskMode:p}}}class mt extends G{constructor(e){super(e)}render(e,n,s){const{items:t,answer:r,currency:i}=this.data,o=n?"color:var(--primary-color); font-weight:bold;":"",l=n?r:"";e.style.flexDirection="column",e.style.gap="10px";let d='<div class="money-items-container" style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center;">';t.forEach(u=>{const p=u>=10||i==="EUR"&&u>=5,m=u<1?(u*100).toFixed(0):u.toString(),f=u<1?i==="EUR"?"c":"Rp.":i==="EUR"?"‚Ç¨":"Fr.";d+=`<div class="${p?"money-note":"money-coin"}" data-value="${u}">${m}<span style="font-size:0.6em; margin-left:1px;">${f}</span></div>`}),d+="</div>";const c=`
            <div style="display:flex; align-items:center; gap:5px; font-weight:bold;">
                Total: <input type="number" step="0.01" class="answer-input" style="width:75px; text-align:center; ${o}" 
                             data-expected="${r}" value="${l}" oninput="validateInput(this)" ${n?"readonly":""}>
                <span>${i==="EUR"?"‚Ç¨":"CHF"}</span>
            </div>`;e.innerHTML=d+c}static generate(e,n,s){const t=e==="money_10"?10:100,r=n.currency||"CHF";let i,o,l;r==="EUR"?(i=[.01,.02,.05,.1,.2,.5,1,2],o=[5,10,20,50,100,200,500].filter(f=>f<=t),l=.01):(i=[.05,.1,.2,.5,1,2,5],o=[10,20,50,100,200,1e3].filter(f=>f<=t),l=.05);let d;t<=10?d=h(10,200)*l:d=h(10,t)*1;const c=1/l;d=Math.round(d*c)/c;let u=d;const p=[],m=[...o,...i].sort((f,g)=>g-f);for(const f of m)if(!(X()<.2))for(;u>=f-l/10&&p.length<12;)p.push(f),u-=f,u=Math.round(u*c)/c;return p.sort(()=>X()-.5),{type:"money",items:p,answer:d,currency:r}}}class gt extends G{constructor(e){super(e)}render(e,n,s){const{a:t,b:r,op:i,answer:o}=this.data;this.data.type==="written"?e.innerHTML=this.renderWrittenArithmetic(t,r,i,n?o:void 0):this.data.type==="long_calculation"&&(i==="√ó"?e.innerHTML=this.renderWrittenMultiplication(t,r,n?o:void 0):e.innerHTML=this.renderWrittenDivision(t,r,n?o:void 0))}renderWrittenArithmetic(e,n,s,t){const r=e.toString(),i=n.toString(),o=Math.max(r.length,i.length)+1,l=t!==void 0?t.toString():"";return`
            <div class="written-vertical">
                <div class="written-row">${r.padStart(o," ")}</div>
                <div class="written-row">${s}${i.padStart(o-1," ")}</div>
                <div class="written-line"></div>
                <div class="written-row"><strong>${t!==void 0?l.padStart(o," "):""}</strong></div>
            </div>`}renderWrittenMultiplication(e,n,s){const t=e.toString(),r=n.toString();let i=`<div class="written-vertical" style="align-items: flex-end;">
            <div class="written-row" style="border-bottom: 1px solid #000; padding-bottom: 2px; margin-bottom: 5px;">${t} √ó ${r}</div>`;if(s!==void 0){for(let o=0;o<r.length;o++){const l=parseInt(r[o]),d=e*l,c=r.length-1-o;i+=`<div class="written-row" style="padding-right: ${c}ch;">${d}</div>`}i+=`<div class="written-line"></div>
                <div class="written-row"><strong>${s}</strong></div>`}return i+="</div>",i}renderWrittenDivision(e,n,s){const t=e.toString(),r=s!==void 0?s.toString():"";let i=`<div class="written-vertical" style="align-items: flex-start; font-size:1.1rem; font-family:'Courier New', monospace; line-height: 1.2;">
            <div class="written-row" style="justify-content: flex-start; letter-spacing: 2px;">${t} : ${n} = ${r}</div>`;if(s!==void 0){let o=0,l=0;for(let d=0;d<r.length;d++){const c=parseInt(r[d]);if(d===0){let g="";for(;o<t.length&&(g+=t[o],o++,!(parseInt(g)>=n)););l=parseInt(g)}else if(o<t.length){const g=t[o];l=parseInt(l.toString()+g),o++}const u=c*n,p=l-u,m=u.toString(),f=o-1-(m.length-1);if(i+=`<div class="written-row" style="justify-content: flex-start; padding-left: ${f}ch; border-bottom: 1px solid #000; width: fit-content;">-${m}</div>`,o<t.length){const g=t[o],b=p.toString()+g,k=o-(b.length-1);i+=`<div class="written-row" style="justify-content: flex-start; padding-left: ${k}ch;">${b}</div>`,l=p}else{const g=p.toString(),b=o-1-(g.length-1);i+=`<div class="written-row" style="justify-content: flex-start; padding-left: ${b}ch;">${g}</div>`}}}return i+="</div>",i}static generate(e,n,s){if(e==="add_written"){let t=h(1e3,99999),r=h(1e3,99999);return{type:"written",a:t,b:r,op:"+",answer:t+r}}else if(e==="sub_written"){let t=h(5e3,99999),r=h(1e3,t-1);return{type:"written",a:t,b:r,op:"-",answer:t-r}}else if(e==="mult_large"){let t=h(100,999),r=h(11,99);return{type:"long_calculation",a:t,b:r,op:"√ó",answer:t*r}}else if(e==="div_long"){let t=h(2,9),r=h(100,999);return{type:"long_calculation",a:r*t,b:t,op:":",answer:r}}}}class ft extends G{constructor(e){super(e)}render(e,n,s){const{answer:t}=this.data,r=n?t:"",i=n?"readonly":"";if(this.data.type==="fraction_simplify"){const{num:o,den:l}=this.data;e.innerHTML=`
                <div class="fraction">
                    <span class="fraction-top">${o}</span>
                    <span class="fraction-bottom">${l}</span>
                </div>
                <span class="equals">=</span>
                <input type="text" class="answer-input" style="width:60px;" placeholder="a/b" data-expected="${t}" value="${r}" oninput="validateInput(this)" ${i}>`}else if(this.data.type==="fraction_op"){const{numA:o,denA:l,numB:d,denB:c,op:u}=this.data;e.innerHTML=`
                <div class="fraction">
                    <span class="fraction-top">${o}</span>
                    <span class="fraction-bottom">${l}</span>
                </div>
                <span class="operator">${u}</span>
                <div class="fraction">
                    <span class="fraction-top">${d}</span>
                    <span class="fraction-bottom">${c}</span>
                </div>
               <span class="equals">=</span>
               <input type="text" class="answer-input" style="width:60px;" placeholder="a/b" data-expected="${t}" value="${r}" oninput="validateInput(this)" ${i}>`}}static generate(e,n,s){if(e==="frac_simplify"){let t=h(1,10),r=h(t+1,20),i=h(2,6),o=t*i,l=r*i;const d=Pe(o,l),c=o/d,u=l/d;return{type:"fraction_simplify",num:o,den:l,answer:`${c}/${u}`}}else if(e==="frac_add"){let t=h(2,12),r=h(1,t-1),i=h(1,t-r);return{type:"fraction_op",numA:r,denA:t,numB:i,denB:t,op:"+",answer:`${r+i}/${t}`}}}}class yt extends G{constructor(e){super(e)}render(e,n,s){const{val:t,place:r,answer:i}=this.data,o=n?i:"",l=window.TRANSLATIONS||{},d=window.lang||"de",c=l[d]?.ui?.roundingLabel||"Round {val} to the nearest {place}:";e.style.flexDirection="column",e.innerHTML=`
             <div style="margin-bottom:5px;">${c.replace("{val}",t.toString()).replace("{place}",r.toString())}</div>
             <input type="number" class="answer-input" style="width:80px;" 
                    data-expected="${i}" value="${o}" oninput="validateInput(this)" ${n?"readonly":""}>`}static generate(e,n,s){let t=h(1e3,99999),r=[10,100,1e3][h(0,2)];return{type:"rounding",val:t,place:r,answer:Math.round(t/r)*r}}}function bt(){["add_10","sub_10","add_20_simple","sub_20_simple","add_20","sub_20","add_100_simple","add_100_carry","sub_100_simple","sub_100_carry","mult_2_5_10","mult_all","div_2_5_10","add_1000","sub_1000","mult_advanced","div_100","dec_add","dec_sub","mult_10_100"].forEach(a=>C.register(a,st)),["rechenmauer_10","rechenmauer_100","rechenmauer","rechenmauer_4"].forEach(a=>C.register(a,lt)),["bonds_10","div_remainder","doubling_halving","rechenstrich","married_100"].forEach(a=>C.register(a,dt)),["time_reading","time_analog_set","time_analog_set_complex","time_duration","visual_add_100","units","percent_basic"].forEach(a=>C.register(a,ct)),["word_problems","word_types","text"].forEach(a=>C.register(a,ut)),["zahlenhaus_10","zahlenhaus_20","zahlenhaus_100"].forEach(a=>C.register(a,pt)),["rechendreiecke","rechendreiecke_100"].forEach(a=>C.register(a,ht)),["money_10","money_100"].forEach(a=>C.register(a,mt)),["add_written","sub_written","mult_large","div_long"].forEach(a=>C.register(a,gt)),["frac_simplify","frac_add"].forEach(a=>C.register(a,ft)),C.register("rounding",yt)}bt();Ie(Ge());Be(ve[L]);window.generateSheet=ee;window.renderCurrentState=je;window.updateURLState=D;window.toggleQRVisibility=Et;window.validateInput=St;window.switchLanguage=be;window.renderBuilderSheet=H;document.getElementById("htmlRoot")&&(document.getElementById("htmlRoot").lang=L);Ne();function Ne(){Object.keys(W).forEach(a=>{W[a].map(e=>({value:e,text:v.topics[e]}))})}function re(a,e={}){window.posthog&&window.posthog.capture(a,e)}function vt(){try{const a=Array.from(M);let e,n="";a.length>1?(e="custom",n=a.join(",")):a.length===1?e=a[0]:e="unknown";const s={grade:O,topic:e,count:document.getElementById("pageCount").value,solutions:document.getElementById("solutionToggle").checked,lang:L};e==="custom"&&(s.custom_modules=n),re("print_sheet",s)}catch(a){console.error("Analytics error:",a)}window.print()}window.printSheet=vt;window.copyLink=function(){const a=window.location.href;navigator.clipboard.writeText(a).then(()=>{const e=document.getElementById("btnCopyLink"),n=e.innerHTML;e.innerHTML="‚úÖ Kopiert!",setTimeout(()=>{e.innerHTML=n},2e3)}).catch(e=>{console.error("Failed to copy: ",e)})};function He(){document.title=v.ui.title;const a={labelSolutions:v.ui.labelSolutions,btnGenerate:v.ui.btnGenerate,btnSave:v.ui.btnSave,btnSaved:v.ui.btnSaved,btnPrint:v.ui.btnPrint,btnPlay:v.ui.btnPlay,labelShowQR:v.ui.labelShowQR||"QR-Code anzeigen",customTitle:v.ui.customTitle,labelMultiplesOf10:v.ui.multiplesOf10,labelCurrency:v.ui.currency,labelHours:v.ui.hours,labelMinutes:v.ui.minutes,modalTitle:v.ui.modalTitle,btnModalClose:v.ui.modalClose,labelFeedback:v.ui.feedback,labelDensity:v.ui.labelDensity,navGenerator:v.ui.navGenerator,navGames:v.ui.navGames,navGameGeo:v.ui.navGameGeo,navAbout:v.ui.navAbout,titleGames:v.ui.titleGames,titleAbout:v.ui.titleAbout,gameCantonTitle:v.ui.gameCantonTitle,gameCantonDesc:v.ui.gameCantonDesc,aboutIntro:v.ui.aboutIntro,btnAddElement:v.ui.builder.addItem,btnRefreshBuilder:v.ui.builder.refresh,btnClearBuilderSheet:v.ui.builder.clear};for(const[t,r]of Object.entries(a)){const i=document.getElementById(t);i&&(i.innerHTML=r)}const e=document.getElementById("btnPrintBuilder");e&&(e.innerHTML=v.ui.btnPrint);const n=document.getElementById("btnCopyBuilderLink");n&&(n.innerHTML="üîó "+v.ui.builder.copyLink);const s=document.getElementById("gradeSelector");s&&Array.from(s.options).forEach(t=>{v.ui.grades[t.value]&&(t.textContent=v.ui.grades[t.value])})}function de(){const a=document.getElementById("gradeTabs");a&&(a.innerHTML="",Object.keys(W).forEach(e=>{const n=document.createElement("div");n.className=`grade-tab ${e===O?"active":""}`,n.textContent=v.ui.grades[e],n.onclick=()=>wt(e),a.appendChild(n)}))}function wt(a){if(O===a)return;ge(a);const e=W[a]||[];M.clear(),e.length>0&&M.add(e[0]),de(),ae(),ee()}function ae(){const a=document.getElementById("topicChips");if(!a)return;a.innerHTML="",(W[O]||[]).forEach(n=>{const s=document.createElement("div"),t=M.has(n);s.className=`topic-chip ${t?"active":""}`,s.textContent=v.topics[n],s.onclick=()=>xt(n),a.appendChild(s)}),_t()}function xt(a){M.has(a)?M.size>1&&M.delete(a):M.add(a),ae(),ee()}function _t(){let a=!1,e=!1,n=!1;M.forEach(i=>{i==="married_100"&&(a=!0),i==="time_reading"&&(e=!0),(i==="money_10"||i==="money_100")&&(n=!0)});const s=document.getElementById("marriedOptions"),t=document.getElementById("timeOptions"),r=document.getElementById("moneyOptions");s&&(s.style.display=a?"flex":"none"),t&&(t.style.display=e?"flex":"none"),r&&(r.style.display=n?"flex":"none")}window.updateTopicSelector=function(){de(),ae()};let ye=!1;function ee(a=!1){ye=!1,ne(a?Z:Math.floor(Math.random()*4294967295)),a||re("generate_sheet",{grade:O,topic:Array.from(M).join(","),count:document.getElementById("pageCount").value});let e;const n=Array.from(M);n.length===1?e=n[0]:n.length>1?e="custom":e="add_10";const s=r=>r.replace(/[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{FE00}-\u{FE0F}]|[\u{1F000}-\u{1F02F}]|[\u{1F0A0}-\u{1F0FF}]|[\u{1F100}-\u{1F64F}]|[\u{1F680}-\u{1F6FF}]|[\u{1F910}-\u{1F96B}]|[\u{1F980}-\u{1F9E0}]/gu,"").trim();me(s(e==="custom"?v.ui.individuelleAufgaben||"Mix":v.topics[e]||"Aufgaben"));const t=parseInt(document.getElementById("pageCount").value)||1;qe([]);for(let r=0;r<t;r++){const i=[];document.getElementById("currencyCHF").checked&&i.push("CHF"),document.getElementById("currencyEUR").checked&&i.push("EUR"),i.length===0&&i.push("CHF");const o={marriedMultiplesOf10:document.getElementById("marriedMultiplesOf10").checked},l=parseInt(document.getElementById("densitySlider").value)||100,d=Math.round(we*(l/100)),c=We(e,n,i,o,L,d);se.push(c)}je(),D()}function kt(){const a={grade:O,topic:Array.from(M).join(","),count:document.getElementById("pageCount").value,seed:Z,lang:L};sessionStorage.setItem("worksheetState",JSON.stringify(a))}function D(){const a=new URLSearchParams,e=ie(),n=e==="generator";if(L&&a.set("lang",L),n){a.set("grade",O);const t=Array.from(M);let r="";t.length>1?(a.set("topic","custom"),a.set("custom",t.join(",")),r="custom"):t.length===1&&(a.set("topic",t[0]),r=t[0]);const i=document.getElementById("pageCount").value;a.set("count",i),document.getElementById("solutionToggle").checked&&a.set("solutions","1"),document.getElementById("showQR").checked||a.set("showQR","0");const d=r==="custom";if((r==="married_100"||d)&&document.getElementById("marriedMultiplesOf10").checked&&a.set("marriedM","1"),(r==="time_reading"||d)&&(document.getElementById("showHours").checked&&a.set("showH","1"),document.getElementById("showMinutes").checked&&a.set("showM","1")),r==="money_10"||r==="money_100"||d){const u=[];document.getElementById("currencyCHF").checked&&u.push("CHF"),document.getElementById("currencyEUR").checked&&u.push("EUR"),u.length>0&&a.set("currencies",u.join(","))}}if(document.getElementById("solutionToggle").checked&&a.set("solutions","1"),document.getElementById("densitySlider").value!=="100"&&a.set("density",document.getElementById("densitySlider").value),document.getElementById("marriedMultiplesOf10").checked&&a.set("marriedM","1"),document.getElementById("showQR").checked?a.delete("showQR"):a.set("showQR","0"),Z&&a.set("seed",Z.toString()),Ve()){const t=Je();a.set("build",t)}const s=`${window.location.pathname}#${e}?${a.toString()}`;window.history.replaceState({},"",s),Mt(window.location.href),ce(),Te()}function je(){const a=document.getElementById("sheetsWrapper");if(!a)return;const e=document.getElementById("solutionToggle").checked;a.innerHTML="",se.forEach((n,s)=>{const t={current:s+1,total:se.length},r=fe(he,n,!1,t,!0);if(a.appendChild(r),e){const i=fe(he,n,!0,t);a.appendChild(i)}}),D(),Se()}window.updateGeneratorTitle=function(a){me(a),D()};function St(a){const e=(a.dataset.expected||"").trim(),n=a.value.trim(),t=a.classList.contains("brick-input")?a.parentElement:a;if(!n){t.classList.remove("correct","incorrect");return}let r=!1;if(n===e)r=!0;else{const i=Number(e),o=Number(n);!isNaN(i)&&!isNaN(o)&&Math.abs(i-o)<1e-5&&(r=!0)}if(!r&&e.includes(":")&&n.includes(":")){const[i,o]=e.split(":").map(Number),[l,d]=n.split(":").map(Number);i===l&&o===d&&(r=!0)}r?(t.classList.add("correct"),t.classList.remove("incorrect"),Tt()):(t.classList.add("incorrect"),t.classList.remove("correct"))}function Tt(){const a=document.querySelectorAll(".answer-input");let e=!0;a.forEach(s=>{if(s.readOnly)return;(s.classList.contains("brick-input")?s.parentElement:s).classList.contains("correct")||(e=!1)});const n=document.getElementById("mascot");n&&(e?n.textContent="üéâ":n.textContent="ü¶ä")}window.setupFocusNavigation=function(){const a=document.getElementById("sheetsWrapper");a&&(a.addEventListener("keydown",e=>{if(e.key==="Enter"){const n=e.target;if(n.matches(".answer-input, .rechenstrich-input, .house-input, .brick-input, .triangle-field")){e.preventDefault();const s=Array.from(a.querySelectorAll("input:not([readonly])")),t=s.indexOf(n);if(t!==-1&&t<s.length-1){const r=s[t+1];r.focus(),(r.type==="number"||r.type==="text")&&r.select(),r.scrollIntoView({behavior:"smooth",block:"center"})}}}}),a.addEventListener("input",e=>{if(!ye&&e.target.tagName==="INPUT"){ye=!0;const n=Array.from(M);let s="",t="";n.length>1?(s="custom",t=n.join(",")):n.length===1?s=n[0]:s="unknown";const r={grade:O,topic:s,count:document.getElementById("pageCount").value,lang:L};s==="custom"&&(r.custom_modules=t),re("work_started",r)}}))};function $e(){He(),ce();const a=document.getElementById("lang-de-header");a&&a.addEventListener("click",n=>{n.preventDefault(),be("de")});const e=document.getElementById("lang-en-header");e&&e.addEventListener("click",n=>{n.preventDefault(),be("en")});try{ze(),ee(!0),Se();const n=new URLSearchParams(window.location.search),s=n.has("seed")||n.has("topic"),t=Array.from(M),r=t.length>1?"custom":t[0]||"unknown";re("page_view",{grade:O,topic:r,is_shared_url:s,hostname:window.location.hostname,path:window.location.pathname,lang:L}),window.setupFocusNavigation(),ce(),Te(),$t(),Qe()}catch(n){console.error("Initialization Error:",n)}}function ze(){const a=sessionStorage.getItem("worksheetState");if(a){const t=JSON.parse(a);t.grade&&ge(t.grade),M.clear(),t.topic&&(t.topic.includes(",")?t.topic.split(",").forEach(i=>M.add(i)):M.add(t.topic)),de(),ae();const r=document.getElementById("pageCount");r&&(r.value=t.count),ne(t.seed),sessionStorage.removeItem("worksheetState"),D();return}const e=V();e.has("seed")&&ne(parseInt(e.get("seed"))),e.has("grade")&&ge(e.get("grade")),M.clear();const n=e.get("topic"),s=e.get("custom");if(n==="custom"&&s)s.split(",").forEach(t=>M.add(t));else if(n&&n!=="custom")M.add(n);else{const t=W[O]||[];t.length>0&&M.add(t[0])}if(de(),ae(),e.has("count")){const t=e.get("count"),r=document.getElementById("pageCount");r&&(r.value=t)}if(e.has("solutions")&&(document.getElementById("solutionToggle").checked=e.get("solutions")==="1"),e.has("density")&&(document.getElementById("densitySlider").value=e.get("density")),e.has("marriedM")&&(document.getElementById("marriedMultiplesOf10").checked=e.get("marriedM")==="1"),e.has("showQR")&&(document.getElementById("showQR").checked=e.get("showQR")!=="0",window.toggleQRVisibility&&window.toggleQRVisibility()),e.has("showH")&&(document.getElementById("showHours").checked=e.get("showH")==="1"),e.has("showM")&&(document.getElementById("showMinutes").checked=e.get("showM")==="1"),e.has("currencies")){const t=e.get("currencies").split(",");document.getElementById("currencyCHF").checked=t.includes("CHF"),document.getElementById("currencyEUR").checked=t.includes("EUR")}}function Et(){const a=document.getElementById("showQR").checked;document.querySelectorAll(".qr-code-container").forEach(n=>{a?n.classList.remove("qr-hidden"):n.classList.add("qr-hidden")}),D()}function Mt(a){document.querySelectorAll(".qr-code-container").forEach(n=>{n.innerHTML="";const s=document.createElement("canvas");n.appendChild(s),window.QRCode&&window.QRCode.toCanvas(s,a,{width:100,margin:0,color:{dark:"#000000",light:"#ffffff"},errorCorrectionLevel:"L"},function(t){t&&console.warn("QR code generation failed:",t)})})}window.saveCurrentState=function(){D();const a=window.location.search;if(!a){alert(v.ui.saveNothing);return}const e=Array.from(M);let n;window.location.hash.includes("builder")||document.getElementById("builder").classList.contains("active-section")?n=v.ui.builder.title||"Baukasten":e.length>1?n=v.ui.individuelleAufgaben||"Mix":e.length===1?n=v.topics[e[0]]||e[0]:n="Arbeitsblatt";const t=`${n} (${new Date().toLocaleDateString(L==="de"?"de-CH":"en-US")})`,r=prompt(v.ui.savePrompt,t);if(r===null)return;const i=JSON.parse(localStorage.getItem("ufzgiblatt_saved")||"[]");i.push({id:Date.now(),name:r||t,params:a,timestamp:new Date().toLocaleString(L==="de"?"de-CH":"en-US")}),localStorage.setItem("ufzgiblatt_saved",JSON.stringify(i)),alert(v.ui.saveSuccess)};window.toggleSavedModal=function(){const a=document.getElementById("savedModal");a.style.display==="block"?a.style.display="none":(window.renderSavedList(),a.style.display="block")};window.renderSavedList=function(){const a=document.getElementById("savedList"),e=JSON.parse(localStorage.getItem("ufzgiblatt_saved")||"[]");if(e.length===0){a.innerHTML=`<p style="text-align:center; padding: 20px;">${v.ui.noSavedWorksheets}</p>`;return}e.sort((n,s)=>s.id-n.id),a.innerHTML=e.map(n=>`
        <div class="saved-item">
            <div class="saved-item-info">
                <span class="saved-item-name">${n.name}</span>
                <span class="saved-item-date">${n.timestamp}</span>
            </div>
            <div class="saved-item-actions">
                <button class="btn-load" onclick="loadSavedState(${n.id})">${v.ui.btnLoad}</button>
                <button class="btn-delete" onclick="deleteSavedState(${n.id})">${v.ui.btnDelete}</button>
            </div>
        </div>
    `).join("")};window.loadSavedState=function(a){const n=JSON.parse(localStorage.getItem("ufzgiblatt_saved")||"[]").find(s=>s.id===a);n&&(window.history.replaceState({},"",window.location.pathname+n.params),ze(),ee(!0),window.toggleSavedModal())};window.deleteSavedState=function(a){if(!confirm(v.ui.confirmDelete))return;let e=JSON.parse(localStorage.getItem("ufzgiblatt_saved")||"[]");e=e.filter(n=>n.id!==a),localStorage.setItem("ufzgiblatt_saved",JSON.stringify(e)),window.renderSavedList()};window.autoScaleSheet=Se;function Se(){[document.getElementById("sheetsWrapper"),document.getElementById("builderSheetsWrapper")].filter(e=>e!==null).forEach(e=>{if(window.matchMedia("print").matches){e.style.transform="none",e.style.height="auto";return}const n=window.innerWidth,s=794;if(n<s){const t=(n-20)/s;e.style.transform=`scale(${t})`,e.style.transformOrigin="top center",e.style.height="auto";const i=e.scrollHeight*t+20;e.style.height=`${i}px`}else e.style.transform="none",e.style.height="auto"})}function $t(){const a=document.querySelectorAll(".nav-link"),e=document.querySelectorAll("section");function n(s){const t=ie();e.forEach(r=>{r.classList.remove("active-section"),r.id===t&&r.classList.add("active-section")}),a.forEach(r=>{r.classList.remove("active");const i=r.getAttribute("href");i&&i.replace("#","")===t&&r.classList.add("active")})}window.addEventListener("hashchange",()=>{n(),D()}),n()}function Te(){document.querySelectorAll('a[href*="geography-game"]').forEach(e=>{const n=V(),s=new URLSearchParams;n.has("lang")&&s.set("lang",n.get("lang")),n.has("seed")&&s.set("seed",n.get("seed")),e.href=`geography-game?${s.toString()}`,e.onclick=t=>{kt()}})}function ce(){const a=[{de:"lang-de-header",en:"lang-en-header"}],e=V();a.forEach(n=>{const s=document.getElementById(n.de),t=document.getElementById(n.en);s&&t&&(L==="de"?(s.classList.add("active"),s.href="javascript:void(0)",t.classList.remove("active"),e.set("lang","en"),t.href="#"+ie()+"?"+e.toString()):(t.classList.add("active"),t.href="javascript:void(0)",s.classList.remove("active"),e.set("lang","de"),s.href="#"+ie()+"?"+e.toString()))})}function be(a){if(a===L)return;re("switch_language",{from:L,to:a}),Oe(a),Ie(a),Be(ve[L]);const e=document.getElementById("htmlRoot");e&&(e.lang=L),He(),Ne(),window.updateTopicSelector(),ee(!0);const n=V();n.set("lang",L);const s=`${window.location.pathname}#${ie()}?${n.toString()}`;window.history.pushState({},"",s),ce(),Te()}function Lt(){const e=V().get("build");e&&et(e)}document.addEventListener("DOMContentLoaded",Lt);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$e):$e()});export default At();
