<!DOCTYPE html>
<html lang="de" id="htmlRoot">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ufzgiblatt.ch</title>
    <link rel="stylesheet" href="style.css?v=spacing">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <script src="js/analytics.js"></script>
</head>

<header class="site-header no-print">
    <div class="header-content">
        <div class="site-logo">
            <a href="/">
                <span class="logo-text">ufzgiblatt<span class="logo-suffix">.ch</span></span>
            </a>
        </div>
        <nav class="main-nav">
            <a href="#generator" class="nav-link active" id="navGenerator">ArbeitsblÃ¤tter</a>
            <a href="#builder" class="nav-link" id="navBuilder">Baukasten</a>
            <div class="nav-dropdown">
                <span class="nav-link dropdown-trigger" id="navGames">Spiele</span>
                <div class="dropdown-content">
                    <a href="geography-game" id="navGameGeo">Geographie</a>
                </div>
            </div>
        </nav>
        <div class="lang-group">
            <a href="?lang=de" class="lang-btn" id="lang-de-header">DE</a>
            <a href="?lang=en" class="lang-btn" id="lang-en-header">EN</a>
        </div>
    </div>
</header>

<main>
    <section id="generator" class="active-section">
        <div class="controls">
            <!-- New Tabs & Chips Layout for Generator -->
            <div id="gradeTabs" class="grade-tabs-container">
                <!-- Grade Tabs Injected JS -->
            </div>

            <div id="topicChips" class="topic-chips-container" style="margin-bottom: 20px;">
                <!-- Topic Chips Injected JS -->
            </div>

            <!-- Removed old Selectors -->
            <select id="gradeSelector" style="display:none"></select>
            <select id="topicSelector" style="display:none"></select>
            <div style="display:flex; align-items:center; margin-top: 5px;">
                <input type="checkbox" id="solutionToggle"
                    style="width:20px; height:20px; margin-right:5px; cursor:pointer;"
                    onchange="renderCurrentState(); updateURLState();">
                <label for="solutionToggle" id="labelSolutions"
                    style="font-family:'Nunito',sans-serif; cursor:pointer;">LÃ¶sungsblatt</label>
            </div>
            <div style="display:flex; align-items:center;">
                <input type="checkbox" id="showQR" checked
                    style="width:20px; height:20px; margin-right:5px; cursor:pointer;" onchange="toggleQRVisibility()">
                <label for="showQR" id="labelShowQR" style="font-family:'Nunito',sans-serif; cursor:pointer;">QR-Code
                    anzeigen</label>
            </div>

            <div style="display:flex; align-items:center; margin-top: 5px;">
                <label for="pageCount" id="labelCount"
                    style="font-weight:bold; margin-right:5px; font-family:'Nunito',sans-serif;">Anzahl:</label>
                <input type="number" id="pageCount" value="1" min="1" max="50" oninput="generateSheet(true)"
                    style="width:70px; padding:8px; border-radius:12px; border:2px solid #ddd; font-family:'Nunito',sans-serif; font-size:1rem; outline:none; text-align:center;">
            </div>
            <div style="display:flex; align-items:center; gap: 5px;">
                <label for="densitySlider" id="labelDensity"
                    style="font-weight:bold; font-family:'Nunito',sans-serif;">Dichte:</label>
                <input type="range" id="densitySlider" min="20" max="100" step="20" value="100"
                    oninput="generateSheet(true)"
                    style="width:80px; accent-color: var(--primary-color); cursor: pointer;">
            </div>
            <div class="creator-actions-secondary"
                style="display:flex; flex-direction:column; gap:10px; width:100%; margin-top:15px;">
                <button class="btn-generate" id="btnGenerate" onclick="generateSheet()" style="background: #3498db;">ğŸ”„
                    Neu wÃ¼rfeln</button>
                <button class="btn-save" id="btnSave" onclick="saveCurrentState()">ğŸ’¾ Speichern</button>
                <button class="btn-saved" id="btnSaved" onclick="toggleSavedModal()">ğŸ“‚ Laden</button>
                <button class="btn-save" id="btnCopyLink" onclick="window.copyLink()" style="background: #27ae60;">ğŸ”—
                    Link kopieren</button>
                <!-- Check button removed in favor of real-time validation -->
                <button class="btn-print" id="btnPrint" onclick="printSheet()">ğŸ–¨ï¸ Drucken</button>
            </div>

            <div class="controls-group" id="marriedOptions"
                style="display:none; align-items:center; font-family:'Nunito',sans-serif; gap:10px; margin-top: 10px; width: 100%;">
                <input type="checkbox" id="marriedMultiplesOf10" style="width:20px; height:20px;"
                    onchange="generateSheet(true)">
                <label for="marriedMultiplesOf10" id="labelMultiplesOf10">Nur Zehnerzahlen</label>
            </div>

            <div class="controls-group" id="moneyOptions"
                style="display:none; align-items:center; font-family:'Nunito',sans-serif; gap:10px; margin-top: 10px; width: 100%;">
                <span style="font-weight:bold;" id="labelCurrency">WÃ¤hrung:</span>

                <input type="checkbox" id="currencyCHF" value="CHF" checked onchange="generateSheet(true)">
                <label for="currencyCHF">CHF</label>

                <input type="checkbox" id="currencyEUR" value="EUR" onchange="generateSheet(true)">
                <label for="currencyEUR">EUR</label>
            </div>

            <div class="controls-group" id="timeOptions"
                style="display:none; align-items:center; font-family:'Nunito',sans-serif; gap:10px; margin-top: 10px; width: 100%;">
                <input type="checkbox" id="showHours" style="width:20px; height:20px;" onchange="generateSheet(true)">
                <label for="showHours" id="labelHours" style="color:green; font-weight:bold;">Stunden</label>

                <input type="checkbox" id="showMinutes" style="width:20px; height:20px;" onchange="generateSheet(true)">
                <label for="showMinutes" id="labelMinutes" style="color:blueviolet; font-weight:bold;">Minuten</label>
            </div>
        </div>


        <div class="sheets-viewport">
            <div id="sheetsWrapper">
                <!-- Sheets will be inserted here -->
            </div>
        </div>
    </section>

    <section id="builder">
        <div class="controls no-print">



            <!-- Builder Navigation -->
            <div style="width: 100%;">
                <div id="builderGradeTabs" class="grade-tabs-container"></div>


                <div id="builderTopicChips" class="topic-chips-container"></div>
            </div>

            <!-- Hidden Selectors for compatibility if needed (but we will refactor logic) -->
            <select id="builderGradeSelector" style="display:none"></select>
            <select id="builderTopicSelector" style="display:none"></select>
            <div id="builderTopicOptions" class="builder-topic-options"
                style="display:flex; gap:15px; align-items:center;">
                <!-- Dynamic options will be inserted here -->
            </div>

            <div style="display:flex; flex-direction:column; gap:10px; margin-left:auto;">
                <button class="btn-generate" id="btnAddElement" onclick="window.addProblemToBuilder()"
                    style="background: var(--secondary-color);">â• Aufgabe hinzufÃ¼gen</button>
                <button class="btn-saved" id="btnClearBuilderSheet" onclick="window.clearBuilder()"
                    style="background: #e74c3c; padding: 8px 16px; font-size: 0.9rem;">ğŸ—‘ï¸ Leeren</button>

                <div style="display:flex; align-items:center; margin-top: 5px;">
                    <input type="checkbox" id="builderSolutionToggle" style="width:20px; height:20px; margin-right:5px;"
                        onchange="renderBuilderSheet(); updateURLState();">
                    <label for="builderSolutionToggle"
                        style="font-family:'Nunito',sans-serif; cursor:pointer;">LÃ¶sungsblatt</label>
                </div>
                <div style="display:flex; align-items:center;">
                    <input type="checkbox" id="builderShowQR" checked style="width:20px; height:20px; margin-right:5px;"
                        onchange="renderBuilderSheet(); updateURLState();">
                    <label for="builderShowQR" style="font-family:'Nunito',sans-serif; cursor:pointer;">QR-Code
                        anzeigen</label>
                </div>
            </div>
            <div class="builder-actions-secondary" style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn-generate" id="btnRefreshBuilder" onclick="window.refreshBuilderSeed()"
                    style="background: #3498db; padding: 8px 16px; font-size: 0.9rem;">ğŸ”„ Neu wÃ¼rfeln</button>
                <button class="btn-save" id="btnSaveBuilder" onclick="saveCurrentState()">ğŸ’¾ Speichern</button>
                <button class="btn-saved" id="btnLoadBuilder" onclick="toggleSavedModal()">ğŸ“‚ Laden</button>
                <button class="btn-save" id="btnCopyBuilderLink" onclick="window.copyBuilderLink()"
                    style="background: #27ae60; padding: 8px 16px; font-size: 0.9rem;">ğŸ”— Link kopieren</button>
                <button class="btn-print" id="btnPrintBuilder" onclick="window.printSheet()">ğŸ–¨ï¸ Drucken</button>
            </div>
        </div>
        <div id="builderSheetContainer" class="builder-sheet-container">
            <div class="sheets-viewport">
                <div id="builderSheetsWrapper">
                    <!-- Live worksheet rendering -->
                </div>
            </div>
        </div>
    </section>

    <section id="games" class="content-section">
        <div class="section-container">
            <h2 class="section-title" id="titleGames">Lernspiele</h2>
            <div class="games-grid">
                <div class="game-card">
                    <div class="game-icon">ğŸ‡¨ğŸ‡­</div>
                    <h3 id="gameCantonTitle">Kanton Master</h3>
                    <p id="gameCantonDesc">Lerne die Schweizer Kantone auf der interaktiven Karte kennen.</p>
                    <a href="geography-game" class="btn-primary" id="btnPlay"
                        style="display: inline-block; text-decoration: none;">Spielen</a>
                </div>
            </div>
        </div>
    </section>


</main>



<div id="savedModal" class="modal no-print">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Gespeicherte ArbeitsblÃ¤tter</h2>
            <span class="close-modal" onclick="toggleSavedModal()">&times;</span>
        </div>
        <div id="savedList" class="saved-list">
            <!-- Saved items will be listed here -->
        </div>
        <div style="text-align: right; margin-top: 15px;">
            <button class="btn-secondary" id="btnModalClose" onclick="toggleSavedModal()">Schliessen</button>
        </div>
    </div>
</div>

<script type="module" src="script.js?v=final"></script>


<footer style="display:flex; flex-direction:column; align-items:center; gap:5px; margin-top:40px; padding-bottom:20px;">
    <a href="https://github.com/Thalwil-fur-Familien/ufzgiblatt/issues/new" target="_blank" class="feedback-button">
        <svg height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true" class="github-icon">
            <path fill="currentColor"
                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
            </path>
        </svg>
        <span id="labelFeedback">Feedback & Fehler melden</span>
    </a>
    <div id="build-info" style="margin-top:10px; font-size:0.8rem; color:#888;">Build: ed8379a (2026-01-19 16:02 CET) - DEV</div>
</footer>
</body>

</html>